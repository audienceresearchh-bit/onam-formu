<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aydƒ±nlatƒ±lmƒ±≈ü Onam Formu | T√úBƒ∞TAK 1001</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            text-align: center;
        }
        .header img {
            height: 50px;
            margin-bottom: 10px;
        }
        .header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        .header .project-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 12px;
            opacity: 0.8;
        }
        .content {
            padding: 25px;
        }
        .section {
            margin-bottom: 25px;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title .icon {
            font-size: 20px;
        }
        .info-text {
            font-size: 14px;
            line-height: 1.7;
            color: #444;
            text-align: justify;
        }
        .info-text p {
            margin-bottom: 12px;
        }
        .highlight-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .highlight-box.warning {
            background: #fef9e7;
            border-left-color: #f39c12;
        }
        .highlight-box.success {
            background: #e8f8f0;
            border-left-color: #27ae60;
        }
        .rights-list {
            list-style: none;
            padding: 0;
        }
        .rights-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .rights-list li .check {
            color: #27ae60;
            font-size: 18px;
            flex-shrink: 0;
        }

        /* Form Alanlarƒ± */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="email"],
        .form-group input[type="tel"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Onay Kutularƒ± */
        .consent-items {
            margin: 20px 0;
        }
        .consent-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .consent-item:hover {
            background: #e8f4f8;
        }
        .consent-item.checked {
            background: #e8f8f0;
            border-color: #27ae60;
        }
        .consent-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            cursor: pointer;
            accent-color: #27ae60;
        }
        .consent-item .text {
            font-size: 14px;
            line-height: 1.5;
            color: #333;
        }
        .consent-item .required {
            color: #e74c3c;
            font-weight: bold;
        }

        /* Onay Butonu Alanƒ± */
        .submit-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }
        .submit-section p {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .btn-clear {
            background: #e74c3c;
            color: white;
        }
        .btn-clear:hover {
            background: #c0392b;
        }
        .btn-confirm {
            background: #27ae60;
            color: white;
            flex: 1;
            justify-content: center;
        }
        .btn-confirm:hover {
            background: #1e8449;
        }
        .btn-confirm:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Onay Sonrasƒ± */
        .confirmation-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .confirmation-overlay.show {
            display: flex;
        }
        .confirmation-box {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: popIn 0.3s ease;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .confirmation-box .icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        .confirmation-box h2 {
            color: #27ae60;
            margin-bottom: 10px;
        }
        .confirmation-box p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .confirmation-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: left;
            margin-bottom: 20px;
            font-size: 13px;
        }
        .confirmation-details .row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .confirmation-details .row:last-child {
            border-bottom: none;
        }
        .confirmation-details .label {
            color: #888;
        }
        .confirmation-details .value {
            font-weight: 600;
            color: #333;
        }
        .btn-download {
            background: #3498db;
            color: white;
            width: 100%;
            justify-content: center;
            margin-bottom: 10px;
        }
        .btn-close {
            background: #95a5a6;
            color: white;
            width: 100%;
            justify-content: center;
        }

        /* Yazdƒ±rma */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            .btn, .signature-actions {
                display: none !important;
            }
            .signature-canvas-container {
                border: 1px solid #000;
            }
        }

        /* Responsive */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .content {
                padding: 15px;
            }
            .header h1 {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AYDINLATILMI≈û ONAM FORMU</h1>
            <div class="subtitle">Katƒ±lƒ±mcƒ± Bilgilendirme ve Onay Belgesi</div>
            <div class="project-info">
                T√úBƒ∞TAK 1001 Ara≈ütƒ±rma Projesi | Proje No: 123B456<br>
                "Cumhuriyetin 100. Yƒ±lƒ±nda Sinema Seyircisi"<br>
                Mersin √úniversitesi | 2024-2026
            </div>
        </div>

        <div class="content">
            <!-- Proje Hakkƒ±nda -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">üìã</span>
                    Ara≈ütƒ±rma Hakkƒ±nda Bilgilendirme
                </div>
                <div class="info-text">
                    <p>Bu ara≈ütƒ±rma, T√úBƒ∞TAK tarafƒ±ndan desteklenen ve Mersin √úniversitesi b√ºnyesinde y√ºr√ºt√ºlen "Cumhuriyetin 100. Yƒ±lƒ±nda Sinema Seyircisi" projesi kapsamƒ±nda ger√ßekle≈ütirilmektedir.</p>
                    <p><strong>Ara≈ütƒ±rmanƒ±n Amacƒ±:</strong> T√ºrkiye'deki sinema seyircilerinin film izleme alƒ±≈ükanlƒ±klarƒ±, tercihleri ve sinema deneyimlerini derinlemesine anlamak.</p>
                    <p><strong>Proje Y√ºr√ºt√ºc√ºs√º:</strong> Do√ß. Dr. Hakan Erkƒ±lƒ±√ß</p>
                    <div class="highlight-box">
                        <strong>E-posta:</strong> herkilic@mersin.edu.tr<br>
                        <strong>Kurum:</strong> Mersin √úniversitesi, ƒ∞leti≈üim Fak√ºltesi
                    </div>
                </div>
            </div>

            <!-- G√∂r√º≈üme Bilgileri -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">üé§</span>
                    G√∂r√º≈üme Hakkƒ±nda
                </div>
                <div class="info-text">
                    <div class="highlight-box">
                        <strong>G√∂r√º≈üme S√ºresi:</strong> Yakla≈üƒ±k 35-45 dakika<br>
                        <strong>G√∂r√º≈üme ≈ûekli:</strong> Online (Zoom)
                    </div>
                    <p>G√∂r√º≈üme sƒ±rasƒ±nda size sinema alƒ±≈ükanlƒ±klarƒ±nƒ±z, film tercihleriniz ve sinema deneyimleriniz hakkƒ±nda sorular y√∂neltilecektir. Cevaplamak istemediƒüiniz sorularƒ± ge√ßebilirsiniz.</p>
                </div>
            </div>

            <!-- Kayƒ±t ve Gizlilik -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">üîí</span>
                    Kayƒ±t ve Gizlilik
                </div>
                <div class="info-text">
                    <ul class="rights-list">
                        <li><span class="check">‚úì</span> G√∂r√º≈üme, yalnƒ±zca ara≈ütƒ±rma ama√ßlƒ± olarak ses veya video ile kayƒ±t altƒ±na alƒ±nabilir.</li>
                        <li><span class="check">‚úì</span> Kimlik bilgileriniz (ad, soyad, telefon) gizli tutulacak ve yayƒ±nlanmayacaktƒ±r.</li>
                        <li><span class="check">‚úì</span> Verileriniz √º√ß√ºnc√º ≈üahƒ±slarla payla≈üƒ±lmayacaktƒ±r.</li>
                    </ul>
                </div>
            </div>

            <!-- Haklarƒ±nƒ±z -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">‚öñÔ∏è</span>
                    Katƒ±lƒ±mcƒ± Haklarƒ±
                </div>
                <div class="info-text">
                    <ul class="rights-list">
                        <li><span class="check">‚úì</span> Katƒ±lƒ±mƒ±nƒ±z tamamen g√∂n√ºll√ºl√ºk esasƒ±na dayanmaktadƒ±r.</li>
                        <li><span class="check">‚úì</span> G√∂r√º≈ümeden istediƒüiniz zaman, sebep g√∂stermeksizin √ßekilebilirsiniz.</li>
                        <li><span class="check">‚úì</span> Cevaplamak istemediƒüiniz sorularƒ± ge√ßebilirsiniz.</li>
                    </ul>
                </div>
            </div>


            <!-- Katƒ±lƒ±mcƒ± Bilgileri Formu -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">üë§</span>
                    Katƒ±lƒ±mcƒ± Bilgileri
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ad Soyad *</label>
                        <input type="text" id="participantName" placeholder="Adƒ±nƒ±z Soyadƒ±nƒ±z" required>
                    </div>
                    <div class="form-group">
                        <label>Tarih</label>
                        <input type="date" id="consentDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Telefon (Opsiyonel)</label>
                        <input type="tel" id="participantPhone" placeholder="05XX XXX XX XX">
                    </div>
                    <div class="form-group">
                        <label>E-posta (Opsiyonel)</label>
                        <input type="email" id="participantEmail" placeholder="ornek@mail.com">
                    </div>
                </div>
            </div>

            <!-- Onay Kutularƒ± -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">‚úÖ</span>
                    Onay Maddeleri
                </div>
                <div class="consent-items">
                    <div class="consent-item" onclick="toggleConsent(this, event)">
                        <input type="checkbox" id="consent1" required>
                        <div class="text">
                            <span class="required">*</span> Yukarƒ±daki bilgileri okudum ve anladƒ±m. Ara≈ütƒ±rmanƒ±n amacƒ±, y√∂ntemi ve katƒ±lƒ±mcƒ± haklarƒ±m konusunda bilgilendirildim.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onay Butonu -->
            <div class="submit-section">
                <p>Yukarƒ±daki t√ºm maddeleri i≈üaretleyerek formu onaylayabilirsiniz.<br>
                <strong>Onayƒ±nƒ±z otomatik olarak ara≈ütƒ±rma ekibine iletilecektir.</strong></p>
                <button class="btn btn-confirm" id="confirmBtn" onclick="submitConsent()" disabled style="width: 100%; justify-content: center; padding: 15px 30px; font-size: 16px;">
                    ‚úÖ Onaylƒ±yorum ve G√∂nder
                </button>
            </div>
        </div>
    </div>

    <!-- Onay Sonrasƒ± Popup -->
    <div class="confirmation-overlay" id="confirmationOverlay">
        <div class="confirmation-box">
            <div class="icon" id="overlayIcon">‚è≥</div>
            <h2 id="overlayTitle">G√∂nderiliyor...</h2>
            <p id="overlayMessage">Onay formunuz ara≈ütƒ±rma ekibine iletiliyor, l√ºtfen bekleyin.</p>
            <div class="confirmation-details">
                <div class="row">
                    <span class="label">Katƒ±lƒ±mcƒ±:</span>
                    <span class="value" id="confirmName">-</span>
                </div>
                <div class="row">
                    <span class="label">Tarih:</span>
                    <span class="value" id="confirmDate">-</span>
                </div>
                <div class="row">
                    <span class="label">Saat:</span>
                    <span class="value" id="confirmTime">-</span>
                </div>
                <div class="row">
                    <span class="label">Onay Kodu:</span>
                    <span class="value" id="confirmCode">-</span>
                </div>
            </div>
            <div id="emailStatus" style="margin-bottom:15px; padding:10px; border-radius:8px; font-size:14px; display:none;"></div>
            <button class="btn btn-close" onclick="closeConfirmation()" style="margin-top:5px;">
                Kapat
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        var APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyQ9U0BLadvrmmreYRa6sq4qc_vtlRpCamKiviQ9EbTzaBUBeJtQ5JuJFeiS96-0c4-5w/exec';

        // Tarih otomatik ayarla
        document.getElementById('consentDate').value = new Date().toISOString().split('T')[0];

        // Onay kutularƒ±
        function toggleConsent(item, event) {
            var checkbox = item.querySelector('input[type="checkbox"]');
            if (event && (event.target === checkbox || event.target.tagName === 'INPUT')) {
                item.classList.toggle('checked', checkbox.checked);
                validateForm();
                return;
            }
            checkbox.checked = !checkbox.checked;
            item.classList.toggle('checked', checkbox.checked);
            validateForm();
        }

        // Form dogrulama
        function validateForm() {
            var name = document.getElementById('participantName').value.trim();
            var c1 = document.getElementById('consent1').checked;
            document.getElementById('confirmBtn').disabled = !(name && c1);
        }

        document.getElementById('participantName').addEventListener('input', validateForm);
        document.querySelectorAll('.consent-item input').forEach(function(cb) {
            cb.addEventListener('change', function() {
                this.closest('.consent-item').classList.toggle('checked', this.checked);
                validateForm();
            });
        });

        // Onay gonder
        function submitConsent() {
            var name = document.getElementById('participantName').value.trim();
            var date = document.getElementById('consentDate').value;
            var now = new Date();
            var time = now.toLocaleTimeString('tr-TR');
            var code = 'ONY-' + Date.now().toString(36).toUpperCase();

            document.getElementById('confirmName').textContent = name;
            document.getElementById('confirmDate').textContent = new Date(date).toLocaleDateString('tr-TR');
            document.getElementById('confirmTime').textContent = time;
            document.getElementById('confirmCode').textContent = code;

            // Butonu devre disi birak
            document.getElementById('confirmBtn').disabled = true;
            document.getElementById('confirmBtn').innerHTML = '‚è≥ PDF Olu≈üturuluyor...';

            // Popup goster
            document.getElementById('overlayIcon').textContent = '‚è≥';
            document.getElementById('overlayTitle').textContent = 'PDF Olu≈üturuluyor...';
            document.getElementById('overlayMessage').textContent = 'Formunuz PDF olarak hazƒ±rlanƒ±p Drive\'a y√ºkleniyor, l√ºtfen bekleyin.';
            document.getElementById('emailStatus').style.display = 'none';
            document.getElementById('confirmationOverlay').classList.add('show');

            var formData = {
                name: name,
                phone: document.getElementById('participantPhone').value,
                email: document.getElementById('participantEmail').value,
                date: new Date(date).toLocaleDateString('tr-TR'),
                time: time,
                code: code,
                consents: {
                    bilgilendirme: document.getElementById('consent1').checked ? 'EVET' : 'HAYIR'
                }
            };

            // PDF olustur ve gonder
            var container = document.querySelector('.container');
            html2canvas(container, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff',
                logging: false,
                windowWidth: 700
            }).then(function(canvas) {
                var jsPDF = window.jspdf.jsPDF;
                var pdf = new jsPDF('p', 'mm', 'a4');
                var pageW = pdf.internal.pageSize.getWidth();
                var pageH = pdf.internal.pageSize.getHeight();
                var margin = 10;
                var imgW = pageW - margin * 2;
                var imgH = (canvas.height * imgW) / canvas.width;

                if (imgH <= pageH - margin * 2) {
                    pdf.addImage(canvas.toDataURL('image/jpeg', 0.9), 'JPEG', margin, margin, imgW, imgH);
                } else {
                    var pos = 0;
                    var page = 0;
                    while (pos < imgH) {
                        if (page > 0) pdf.addPage();
                        var usable = pageH - margin * 2;
                        var srcY = (pos / imgH) * canvas.height;
                        var srcH = Math.min((usable / imgH) * canvas.height, canvas.height - srcY);
                        var tmpC = document.createElement('canvas');
                        tmpC.width = canvas.width;
                        tmpC.height = srcH;
                        tmpC.getContext('2d').drawImage(canvas, 0, srcY, canvas.width, srcH, 0, 0, canvas.width, srcH);
                        var drawH = (srcH * imgW) / canvas.width;
                        pdf.addImage(tmpC.toDataURL('image/jpeg', 0.9), 'JPEG', margin, margin, imgW, drawH);
                        pos += usable;
                        page++;
                    }
                }

                // PDF'i base64'e cevir
                var pdfBase64 = pdf.output('datauristring').split(',')[1];

                document.getElementById('overlayTitle').textContent = 'Drive\'a Y√ºkleniyor...';
                document.getElementById('overlayMessage').textContent = 'PDF olu≈üturuldu, Drive\'a y√ºkleniyor...';

                var dateStr = new Date().toISOString().slice(0, 10);
                var fileName = 'Onam_' + name.replace(/\s+/g, '_') + '_' + dateStr + '.pdf';

                // Google Drive'a y√ºkle
                fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        folderName: 'Onam_Formlari',
                        files: [{
                            fileName: fileName,
                            mimeType: 'application/pdf',
                            data: pdfBase64
                        }]
                    })
                }).then(function() {
                    document.getElementById('overlayIcon').textContent = '‚úÖ';
                    document.getElementById('overlayTitle').textContent = 'Onay Alƒ±ndƒ±!';
                    document.getElementById('overlayMessage').textContent = 'Onam formunuz PDF olarak Google Drive\'a y√ºklendi. Katƒ±lƒ±mƒ±nƒ±z i√ßin te≈üekk√ºr ederiz.';
                    var statusEl = document.getElementById('emailStatus');
                    statusEl.style.display = 'block';
                    statusEl.style.background = '#e8f8f0';
                    statusEl.style.color = '#27ae60';
                    statusEl.innerHTML = '‚úÖ PDF olu≈üturuldu ve Drive\'a y√ºklendi!';
                }).catch(function(err) {
                    console.error('Gonderim hatasi:', err);
                    showEmailError();
                });

            }).catch(function(err) {
                console.error('PDF hatasi:', err);
                showEmailError();
            });
        }

        function showEmailError() {
            document.getElementById('overlayIcon').textContent = '‚ö†Ô∏è';
            document.getElementById('overlayTitle').textContent = 'Onay Kaydedildi';
            document.getElementById('overlayMessage').textContent = 'Onayƒ±nƒ±z kaydedildi ancak Drive\'a y√ºklenemedi. L√ºtfen ekran g√∂r√ºnt√ºs√º alarak ara≈ütƒ±rma ekibine iletin.';
            var statusEl = document.getElementById('emailStatus');
            statusEl.style.display = 'block';
            statusEl.style.background = '#fef9e7';
            statusEl.style.color = '#e67e22';
            statusEl.innerHTML = '‚ö†Ô∏è Drive\'a y√ºklenemedi. Ekran g√∂r√ºnt√ºs√º alarak iletebilirsiniz.';
        }

        function closeConfirmation() {
            document.getElementById('confirmationOverlay').classList.remove('show');
            document.getElementById('confirmBtn').innerHTML = '‚úÖ Onaylƒ±yorum ve G√∂nder';
            validateForm();
        }
    </script>
</body>
</html>

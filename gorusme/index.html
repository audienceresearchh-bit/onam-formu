<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derinlemesine G√∂r√º≈üme Soru Formu | T√úBƒ∞TAK 1001</title>
    <!-- WAV Cue Point K√ºt√ºphanesi -->
    <script src="https://cdn.jsdelivr.net/npm/wavefile@11.0.0/dist/wavefile.min.js"></script>
    <!-- PDF Olu≈üturma K√ºt√ºphaneleri -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }

        /* G√ñR√ú≈ûME Bƒ∞LGƒ∞ FORMU */
        .interview-info-box {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
        }
        .interview-info-box h3 {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        .interview-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .form-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-field label {
            font-size: 12px;
            text-transform: uppercase;
            opacity: 0.8;
            font-weight: 500;
        }
        .form-field input, .form-field select {
            padding: 10px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            background: rgba(255,255,255,0.95);
            color: #333;
        }
        .form-field input:focus, .form-field select:focus {
            outline: 3px solid #3498db;
        }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
        }
        .status-dot.saved { background: #27ae60; }
        .status-text { font-size: 13px; opacity: 0.9; }

        /* KAYDET/YAZDIR BUTONLARI */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }
        .btn-save {
            background: #27ae60;
            color: white;
        }
        .btn-print {
            background: #3498db;
            color: white;
        }
        .btn-clear {
            background: #e74c3c;
            color: white;
        }
        .btn-export {
            background: #9b59b6;
            color: white;
        }
        .btn-record {
            background: #e74c3c;
            color: white;
        }
        .btn-record.recording {
            background: #c0392b;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .btn-json {
            background: #f39c12;
            color: white;
        }
        .btn-edit {
            background: #e67e22;
            color: white;
        }
        .btn-edit.active {
            background: #d35400;
            box-shadow: 0 0 0 3px rgba(230, 126, 34, 0.4);
        }

        /* D√úZENLEME MODU STƒ∞LLERƒ∞ */
        body.edit-mode .question-text .main {
            background: #fff3cd;
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px dashed #f39c12;
            display: block;
            margin-top: 5px;
            cursor: text;
        }
        body.edit-mode .question-text .main:focus {
            outline: none;
            border-color: #e67e22;
            background: #ffeaa7;
        }
        body.edit-mode .probe ul li {
            background: #e8f4f8;
            padding: 6px 10px;
            border-radius: 4px;
            margin-bottom: 5px;
            border: 1px dashed #3498db;
            position: relative;
            padding-right: 70px;
        }
        body.edit-mode .probe ul li:focus {
            outline: none;
            background: #d4edda;
            border-color: #27ae60;
        }
        .edit-controls {
            display: none;
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            gap: 3px;
        }
        body.edit-mode .edit-controls {
            display: flex;
        }
        .edit-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .edit-btn-delete {
            background: #e74c3c;
            color: white;
        }
        .edit-btn-delete:hover {
            background: #c0392b;
        }
        .edit-btn-add {
            background: #27ae60;
            color: white;
        }
        .edit-btn-add:hover {
            background: #1e8449;
        }
        .add-probe-btn {
            display: none;
            margin-top: 10px;
            padding: 8px 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        body.edit-mode .add-probe-btn {
            display: inline-block;
        }
        .add-probe-btn:hover {
            background: #1e8449;
        }
        .add-question-btn {
            display: none;
            width: 100%;
            margin: 20px 0;
            padding: 15px 20px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: 2px dashed #1e8449;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
        }
        body.edit-mode .add-question-btn {
            display: block;
        }
        .add-question-btn:hover {
            background: linear-gradient(135deg, #1e8449, #27ae60);
            transform: scale(1.01);
        }
        .delete-question-btn {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            z-index: 10;
        }
        body.edit-mode .delete-question-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .delete-question-btn:hover {
            background: #c0392b;
        }
        .question {
            position: relative;
        }
        .connection-note {
            position: relative;
        }
        body.edit-mode .connection-note {
            background: #f5eef8;
            border: 2px dashed #9b59b6;
            padding-right: 40px;
        }
        body.edit-mode .connection-note:focus {
            outline: none;
            background: #e8daef;
            border-color: #8e44ad;
        }
        .delete-note-btn {
            display: none;
            position: absolute;
            top: 50%;
            right: 8px;
            transform: translateY(-50%);
            background: #e74c3c;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }
        body.edit-mode .delete-note-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .delete-note-btn:hover {
            background: #c0392b;
        }
        .add-connection-btn {
            display: none;
            margin-top: 8px;
            padding: 6px 12px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        body.edit-mode .add-connection-btn {
            display: inline-block;
        }
        .add-connection-btn:hover {
            background: #8e44ad;
        }
        .edit-mode-banner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-weight: 600;
            z-index: 9998;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        body.edit-mode .edit-mode-banner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        body.edit-mode .container {
            margin-top: 50px;
        }
        body.edit-mode .header h1,
        body.edit-mode .header .subtitle {
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px dashed rgba(255,255,255,0.5);
            cursor: text;
        }
        body.edit-mode .header h1:focus,
        body.edit-mode .header .subtitle:focus {
            outline: none;
            background: rgba(255,255,255,0.25);
            border-color: #f1c40f;
        }
        @media print {
            .edit-mode-banner { display: none !important; }
            .edit-controls { display: none !important; }
            .add-probe-btn { display: none !important; }
        }

        /* CANLI TRANSKRƒ∞PT PANELƒ∞ */
        .transcript-panel {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-height: 200px;
            background: rgba(0,0,0,0.92);
            color: #eee;
            z-index: 9997;
            border-top: 3px solid #3498db;
            font-size: 14px;
            font-family: 'Segoe UI', sans-serif;
        }
        .transcript-panel.active { display: flex; flex-direction: column; }
        .transcript-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 15px;
            background: #2c3e50;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .transcript-panel-header .tp-status {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .transcript-panel-header .tp-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: #e74c3c;
        }
        .transcript-panel-header .tp-dot.listening { background: #2ecc71; animation: blink 1s infinite; }
        .transcript-panel-body {
            overflow-y: auto;
            padding: 10px 15px;
            flex: 1;
            scroll-behavior: smooth;
        }
        .transcript-line {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            line-height: 1.5;
        }
        .transcript-line .tl-time {
            color: #3498db;
            font-family: monospace;
            font-size: 11px;
            margin-right: 8px;
        }
        .transcript-line .tl-text { color: #eee; }
        .transcript-line .tl-interim { color: #999; font-style: italic; }
        .transcript-line .tl-confidence {
            color: #f39c12;
            font-size: 10px;
            margin-left: 6px;
            opacity: 0.6;
        }
        .transcript-panel-actions {
            display: flex;
            gap: 8px;
        }
        .transcript-panel-actions button {
            background: none;
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
        }
        .transcript-panel-actions button:hover {
            background: rgba(255,255,255,0.1);
        }

        /* SABƒ∞T KAYIT G√ñSTERGESƒ∞ (Floating) */
        .floating-recorder {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(192, 57, 43, 0.5);
            z-index: 9999;
            display: none;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
            animation: floatPulse 2s infinite;
        }
        .floating-recorder.active {
            display: flex;
        }
        @keyframes floatPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(192, 57, 43, 0.5); }
            50% { box-shadow: 0 4px 30px rgba(192, 57, 43, 0.8); }
        }
        .floating-recorder .rec-icon {
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        .floating-recorder .timer {
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
        }
        .floating-recorder .shortcut-hint {
            font-size: 11px;
            opacity: 0.8;
            border-left: 1px solid rgba(255,255,255,0.3);
            padding-left: 12px;
            margin-left: 4px;
        }
        .floating-recorder button {
            background: white;
            color: #c0392b;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }
        .floating-recorder button:hover {
            background: #f0f0f0;
        }

        /* SES KAYDI B√ñL√úM√ú */
        .recording-section {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(192, 57, 43, 0.3);
        }
        .recording-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .recording-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .recording-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            font-size: 13px;
        }
        .rec-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #fff;
        }
        .rec-dot.active {
            background: #2ecc71;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .recording-timer {
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
        }
        .zoom-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .zoom-info label {
            font-size: 12px;
            opacity: 0.8;
            display: block;
            margin-bottom: 5px;
        }
        .zoom-info input {
            width: 100%;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
        }
        .recordings-list {
            margin-top: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px;
        }
        .recordings-list h4 {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        .recording-item {
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .recording-item:last-child { margin-bottom: 0; }
        .recording-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .recording-item-name {
            font-weight: 500;
        }
        .recording-item button {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            background: white;
            color: #e74c3c;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }
        .recording-item button:hover {
            background: #f0f0f0;
        }
        .recording-item audio {
            width: 100%;
            height: 40px;
            margin-top: 8px;
        }

        /* ZAMAN DAMGASI */
        .timestamp-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 10px;
        }
        .timestamp-btn:hover {
            background: #8e44ad;
        }
        .timestamps-list {
            margin-top: 8px;
            margin-bottom: 8px;
            font-size: 12px;
            color: #8e44ad;
            min-height: 5px;
        }
        .timestamps-list:empty {
            display: none;
        }
        .timestamps-list span {
            display: inline-block;
            background: #f5eef8;
            padding: 4px 10px;
            border-radius: 12px;
            margin: 3px;
            font-weight: 500;
            border: 1px solid #d8bfe8;
        }

        /* NOT ALANLARI */
        .note-area {
            margin-top: 12px;
            background: #fff8e1;
            border: 2px dashed #ffc107;
            border-radius: 8px;
            padding: 12px;
        }
        .note-area-label {
            font-size: 11px;
            text-transform: uppercase;
            color: #ff8f00;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .note-area textarea {
            width: 100%;
            min-height: 60px;
            padding: 10px;
            border: 1px solid #ffe082;
            border-radius: 6px;
            font-family: inherit;
            font-size: 13px;
            resize: vertical;
            background: white;
        }
        .note-area textarea:focus {
            outline: 2px solid #ffc107;
            border-color: #ffc107;
        }
        .note-area textarea::placeholder {
            color: #bbb;
            font-style: italic;
        }

        .header {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
        }
        .header h1 { font-size: 24px; margin-bottom: 5px; }
        .header .subtitle { font-size: 18px; opacity: 0.9; margin-bottom: 15px; }
        .header .meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 13px;
            opacity: 0.85;
            border-top: 1px solid rgba(255,255,255,0.3);
            padding-top: 15px;
            margin-top: 10px;
        }
        .header .meta span { display: flex; align-items: center; gap: 5px; }

        .info-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .info-box h3 {
            color: #8e44ad;
            font-size: 16px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0e6f5;
        }
        .info-box ul { margin-left: 20px; }
        .info-box li { margin-bottom: 8px; }

        .profile-summary {
            background: linear-gradient(135deg, #f8f4fc, #f0e6f5);
            border-left: 4px solid #8e44ad;
        }
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .profile-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
        }
        .profile-item .label { font-size: 11px; color: #666; text-transform: uppercase; }
        .profile-item .value { font-size: 14px; font-weight: 600; color: #8e44ad; }

        .section {
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .section-header {
            padding: 15px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .section-header.isinma { background: linear-gradient(90deg, #27ae60, #2ecc71); }
        .section-header.ana { background: linear-gradient(90deg, #8e44ad, #9b59b6); }
        .section-header.sinif { background: linear-gradient(90deg, #16a085, #1abc9c); }
        .section-header.derinlestirme { background: linear-gradient(90deg, #e67e22, #f39c12); }
        .section-header.kapanis { background: linear-gradient(90deg, #3498db, #5dade2); }

        .section-header h2 { font-size: 16px; }
        .section-header .time {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
        }

        .section-content { padding: 20px; }

        .question {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .question:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

        .question-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: #8e44ad;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-size: 13px;
            font-weight: bold;
            margin-right: 10px;
        }
        .question-text {
            font-size: 15px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .question-text .main { display: inline; }

        .probe {
            background: none;
            padding: 12px 18px;
            margin-top: 10px;
            font-size: 15px;
        }
        .probe-title {
            font-weight: 600;
            color: #555;
            font-size: 13px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .probe ul { margin-left: 15px; margin-top: 5px; }
        .probe li { margin-bottom: 5px; color: #444; font-size: 15px; }

        .moderator-note {
            background: #eaf2f8;
            border-left: 3px solid #3498db;
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 0 6px 6px 0;
            font-size: 13px;
        }
        .moderator-note-title {
            font-weight: 600;
            color: #1a5276;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .connection-note {
            background: #f5eef8;
            border-left: 3px solid #8e44ad;
            padding: 8px 12px;
            margin-top: 8px;
            border-radius: 0 6px 6px 0;
            font-size: 12px;
            color: #6c3483;
        }
        .connection-note strong { color: #8e44ad; }

        .time-guide {
            background: #fff;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .time-guide h3 { color: #7f8c8d; margin-bottom: 15px; font-size: 14px; }
        .time-bar {
            display: flex;
            height: 30px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .time-bar div {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: white;
            font-weight: 500;
        }
        .time-bar .t-isinma { background: #27ae60; width: 9%; }
        .time-bar .t-ana { background: #8e44ad; width: 34%; }
        .time-bar .t-sinif { background: #16a085; width: 14%; }
        .time-bar .t-derinlestirme { background: #e67e22; width: 34%; }
        .time-bar .t-kapanis { background: #3498db; width: 9%; }
        .time-legend {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
        }

        .checklist {
            background: #e8f6f3;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .checklist h4 { color: #1abc9c; font-size: 13px; margin-bottom: 10px; }
        .checklist label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        .checklist input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #1abc9c;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
        }

        @media print {
            body { background: white; }
            .container { max-width: 100%; padding: 10px; }
            .section { break-inside: avoid; }
            .checklist input[type="checkbox"] { -webkit-appearance: none; border: 1px solid #999; }
            .action-buttons { display: none; }
            .status-indicator { display: none; }
            .recording-section { display: none; }
            .transcript-panel { display: none !important; }
            .timestamp-btn { display: none; }
            .interview-info-box {
                background: #f5f5f5 !important;
                color: #333 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .interview-info-box input, .interview-info-box select {
                border: 1px solid #ccc !important;
                background: white !important;
            }
            .note-area {
                border: 1px solid #ccc;
                background: #fffef5 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .note-area textarea {
                border: 1px solid #ddd !important;
                min-height: 80px;
            }
            .form-field input:empty::after,
            .note-area textarea:empty::after {
                content: '_______________';
            }
        }
    </style>
</head>
<body>
    <!-- SABƒ∞T KAYIT G√ñSTERGESƒ∞ -->
    <div class="floating-recorder" id="floatingRecorder">
        <div class="rec-icon"></div>
        <span class="timer" id="floatingTimer">00:00:00</span>
        <span class="shortcut-hint">3 = Zaman</span>
        <button onclick="addQuickMarker()">+ Zaman</button>
        <button onclick="toggleRecording()">Durdur</button>
    </div>

    <!-- CANLI TRANSKRƒ∞PT PANELƒ∞ -->
    <div class="transcript-panel" id="transcriptPanel">
        <div class="transcript-panel-header">
            <div class="tp-status">
                <div class="tp-dot" id="transcriptDot"></div>
                <span id="transcriptStatus">De≈üifre bekliyor...</span>
            </div>
            <div class="transcript-panel-actions">
                <button onclick="toggleTranscriptPanel()">K√º√ß√ºlt</button>
            </div>
        </div>
        <div class="transcript-panel-body" id="transcriptBody">
            <div style="color: #888; font-style: italic; font-size: 13px;">Kayƒ±t ba≈üladƒ±ƒüƒ±nda canlƒ± de≈üifre burada g√∂r√ºnecek...</div>
        </div>
    </div>

    <!-- D√úZENLEME MODU BANNER -->
    <div class="edit-mode-banner" id="editModeBanner">
        ‚úèÔ∏è D√úZENLEME MODU AKTƒ∞F
        <button onclick="saveQuestionChanges()" style="background: #27ae60; border: none; padding: 6px 15px; border-radius: 4px; color: white; cursor: pointer; font-weight: 500;">üíæ Deƒüi≈üiklikleri Kaydet</button>
        <button onclick="toggleEditMode()" style="background: rgba(255,255,255,0.2); border: none; padding: 6px 15px; border-radius: 4px; color: white; cursor: pointer;">‚úñ Kapat</button>
    </div>

    <!-- D√úZENLEME MODU ƒ∞PUCU KUTUSU -->
    <div class="edit-mode-tips" id="editModeTips" style="display: none; position: fixed; top: 55px; right: 20px; background: white; border-radius: 10px; padding: 15px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 9997; max-width: 320px; font-size: 13px; border-left: 4px solid #e67e22;">
        <div style="font-weight: 600; color: #e67e22; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
            üí° D√ºzenleme ƒ∞pu√ßlarƒ±
            <button onclick="document.getElementById('editModeTips').style.display='none'" style="background: none; border: none; cursor: pointer; font-size: 16px; color: #999;">‚úï</button>
        </div>
        <ul style="margin: 0; padding-left: 18px; line-height: 1.8; color: #555;">
            <li><b style="color: #8e44ad;">Ba≈ülƒ±k:</b> √ústteki mor alandaki metne tƒ±klayƒ±n</li>
            <li><b style="color: #f39c12;">Sorular:</b> Sarƒ± kutulardaki metne tƒ±klayƒ±n</li>
            <li><b style="color: #3498db;">Takip sorularƒ±:</b> Mavi kutulara tƒ±klayƒ±n</li>
            <li><b style="color: #9b59b6;">Anket baƒülantƒ±sƒ±:</b> Mor kutulara tƒ±klayƒ±n</li>
            <li><b style="color: #27ae60;">Yeni ekle:</b> Ye≈üil (+) butonlarƒ±nƒ± kullanƒ±n</li>
            <li><b style="color: #e74c3c;">Silmek i√ßin:</b> Kƒ±rmƒ±zƒ± (‚úï) butonlarƒ±na tƒ±klayƒ±n</li>
        </ul>
        <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid #eee; color: #888; font-size: 11px;">
            ‚ö†Ô∏è Deƒüi≈üiklikleri kaydetmeyi unutmayƒ±n!
        </div>
    </div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>DERƒ∞NLEMESƒ∞NE G√ñR√ú≈ûME SORU FORMU</h1>
            <div class="subtitle">Sinema Seyircisi Ara≈ütƒ±rmasƒ±</div>
            <div class="meta">
                <span>T√úBƒ∞TAK 1001 - Cumhuriyetin 100. Yƒ±lƒ±nda Sinema Seyircisi</span>
                <span>31 Temel + 7 Ek Soru</span>
                <span>4 Kategori</span>
                <span>Y√ºz Y√ºze/Online</span>
            </div>
        </div>

        <!-- G√ñR√ú≈ûME Bƒ∞LGƒ∞ FORMU -->
        <div class="interview-info-box">
            <h3>G√∂r√º≈üme Bilgileri</h3>
            <div class="interview-form-grid">
                <div class="form-field">
                    <label>G√∂r√º≈ümeci (Siz)</label>
                    <input type="text" id="interviewer-name" placeholder="Adƒ±nƒ±z Soyadƒ±nƒ±z">
                </div>
                <div class="form-field">
                    <label>Katƒ±lƒ±mcƒ± ƒ∞smi</label>
                    <input type="text" id="participant-name" placeholder="G√∂r√º≈ü√ºlen ki≈üinin adƒ±">
                </div>
                <div class="form-field">
                    <label>Odak Grubu</label>
                    <select id="focus-group">
                        <option value="G1">Grup 1 - Baƒüƒ±msƒ±z</option>
                        <option value="G2">Grup 2 - Pop√ºler</option>
                        <option value="G3">Grup 3 - Yabancƒ±</option>
                        <option value="G4">Grup 4 - Yerli</option>
                        <option value="G5">Grup 5 - 55 Ya≈ü √úst√º</option>
                        <option value="G6">Grup 6 - Liseli Gen√ßler (18-20)</option>
                        <option value="G7">Grup 7 - √úniversite √ñƒürencileri</option>
                        <option value="G8">Grup 8 - Kadƒ±n</option>
                        <option value="G9">Grup 9 - Anadolu</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>G√∂r√º≈üme Tarihi</label>
                    <input type="date" id="interview-date">
                </div>
                <div class="form-field">
                    <label>Ba≈ülangƒ±√ß Saati</label>
                    <input type="time" id="interview-time">
                </div>
                <div class="form-field">
                    <label>G√∂r√º≈üme Durumu</label>
                    <select id="interview-status">
                        <option value="basladi">Ba≈üladƒ±</option>
                        <option value="devam">Devam Ediyor</option>
                        <option value="tamamlandi">Tamamlandƒ±</option>
                        <option value="iptal">ƒ∞ptal Edildi</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>G√∂r√º≈üme T√ºr√º</label>
                    <select id="interview-type">
                        <option value="online">Online (Zoom/Meet)</option>
                        <option value="telefon">Telefon</option>
                        <option value="yuzyuze">Y√ºz Y√ºze</option>
                    </select>
                </div>
            </div>
            <div class="status-indicator">
                <div class="status-dot" id="save-status-dot"></div>
                <span class="status-text" id="save-status-text">Hen√ºz kaydedilmedi</span>
            </div>
        </div>

        <!-- SES KAYDI B√ñL√úM√ú -->
        <div class="recording-section">
            <h3>Ses Kaydƒ± ve Zoom</h3>


            <div class="recording-controls">
                <button class="btn btn-record" id="recordBtn" onclick="toggleRecording()">
                    <span id="recordBtnText">Kayda Ba≈üla</span>
                </button>
                <div class="recording-status">
                    <div class="rec-dot" id="recDot"></div>
                    <span class="recording-timer" id="recordingTimer">00:00:00</span>
                </div>
            </div>
            <div class="zoom-info">
                <label>Zoom Kayƒ±t Bilgisi (opsiyonel)</label>
                <input type="text" id="zoom-recording-info" placeholder="Zoom kayƒ±t dosya adƒ± veya linki...">
            </div>
            <div class="recordings-list" id="recordingsList" style="display: none;">
                <h4>Kaydedilen Ses Dosyalarƒ±</h4>
                <div id="recordingsContainer"></div>
            </div>

            <!-- KLAVYE KISAYOLLARI Bƒ∞LGƒ∞ NOTU -->
            <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid #f1c40f;">
                <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #f1c40f;">‚å®Ô∏è Klavye Kƒ±sayollarƒ±</h4>
                <div style="display: flex; gap: 20px; font-size: 13px; flex-wrap: wrap;">
                    <div>
                        <strong style="color: #2ecc71;">1</strong><br>
                        <span style="opacity: 0.9;">Kayƒ±t Ba≈ülat</span>
                    </div>
                    <div>
                        <strong style="color: #fff;">2</strong><br>
                        <span style="opacity: 0.9;">Kayƒ±t Durdur</span>
                    </div>
                    <div>
                        <strong style="color: #f1c40f;">3</strong><br>
                        <span style="opacity: 0.9;">Zaman</span>
                    </div>
                    <div>
                        <strong style="color: #3498db;">4</strong><br>
                        <span style="opacity: 0.9;">Kaydet</span>
                    </div>
                    <div>
                        <strong style="color: #9b59b6;">5</strong><br>
                        <span style="opacity: 0.9;">D√ºzenleme</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- B√ñL√úM 1: SOSYO-DEMOGRAFƒ∞K YAPI -->
        <div class="section">
            <div class="section-header isinma">
                <h2>KATEGORƒ∞ 1: Sosyo-Demografik Yapƒ± (Soru 1-10)</h2>
                <span class="time">~15 dakika</span>
            </div>
            <div class="section-content">

                <!-- SORU 1 -->
                <div class="question" style="margin-top: 20px;">
                    <div class="question-text">
                        <span class="question-number">1</span>
                        <span class="main">Kendinizden biraz bahsedebilir misiniz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(1)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q1"></div>
                </div>

                <!-- SORU 2 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">2</span>
                        <span class="main">Nasƒ±l bir yerde doƒüdunuz ve b√ºy√ºd√ºn√ºz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(2)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q2"></div>
                    <div class="probe">
                        <div class="probe-title">Takip Sorusu</div>
                        <ul>
                            <li>√áocukluƒüunuz ve gen√ßliƒüiniz nasƒ±l bir √ßevrede ve atmosferde ge√ßti?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 3 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">3</span>
                        <span class="main">Anne-babanƒ±z nerede/nasƒ±l bir yerde b√ºy√ºm√º≈üler?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(3)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q3"></div>
                </div>

                <!-- SORU 4 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">4</span>
                        <span class="main">Evde hangi dil veya diller aƒüƒ±rlƒ±klƒ± konu≈üulurdu?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(4)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q4"></div>
                    <div class="probe">
                        <ul>
                            <li>Anne-babanƒ±zƒ±n bildiƒüi ba≈üka diller var mƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 5 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">5</span>
                        <span class="main">Anne-babanƒ±z ne i≈üle uƒüra≈üƒ±yorlar?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(5)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q5"></div>
                </div>

                <!-- SORU 6 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">6</span>
                        <span class="main">Ailenizin g√ºndelik hayatƒ± nasƒ±l ge√ßerdi? Serbest zamanlarƒ±nda neler yaparlardƒ±?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(6)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q6"></div>
                    <div class="probe">
                        <ul>
                            <li>Spor, k√ºlt√ºrel etkinlikler, sanat, gezi, seyahat?</li>
                            <li>Evde m√ºzik/TV-radyo alƒ±≈ükanlƒ±klarƒ± nasƒ±ldƒ±? TV/Radyoda neler takip edilirdi?</li>
                            <li>Ailede sanatla ilgilenen/eƒüitim alan biri var mƒ±ydƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 7 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">7</span>
                        <span class="main">Eve kitap ve gazete/s√ºreli yayƒ±nlar alƒ±nƒ±r mƒ±ydƒ±?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(7)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q7"></div>
                    <div class="probe">
                        <ul>
                            <li>Evinizde kitaplƒ±k/k√ºt√ºphane var mƒ±ydƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 8 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">8</span>
                        <span class="main">Eƒüitim durumunuzu √∂ƒürenebilir miyiz? Hangi okullarda okudunuz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(8)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q8"></div>
                    <div class="probe">
                        <ul>
                            <li>Eƒüitim hayatƒ±nƒ±zdaki okul deneyimlerinizi nasƒ±l anƒ±msƒ±yorsunuz? Detaylandƒ±rabilir misiniz?</li>
                            <li>Sanatla ilgili bir eƒüitim aldƒ±nƒ±z mƒ± (kurs, enstr√ºman, etkinlik)?</li>
                            <li>Okul/okullarƒ±nƒ±z ve eƒüitim deneyiminiz size ne bƒ±raktƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 9 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">9</span>
                        <span class="main">√ñƒürenci ise bir i≈üle aynƒ± zamanda uƒüra≈üƒ±yor musunuz? √ñƒürenci deƒüilse ne i≈ü yapƒ±yorsunuz? Nerede/hangi sekt√∂rde √ßalƒ±≈üƒ±yorsunuz? (Kamu/√∂zel vb.)</span>
                        <button class="timestamp-btn" onclick="addTimestamp(9)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q9"></div>
                </div>

                <!-- SORU 10 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">10</span>
                        <span class="main">Kendinizi ekonomik olarak hangi sƒ±nƒ±fa yakƒ±n g√∂r√ºyorsunuz, neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(10)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q10"></div>
                    <div class="probe">
                        <ul>
                            <li>Aylƒ±k kazancƒ±nƒ±z yakla≈üƒ±k olarak ne kadar?</li>
                            <li>Evinize giren hane geliri toplamƒ± nedir?</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- B√ñL√úM 2: MEDYA ALI≈ûKANLIKLARI VE ERƒ∞≈ûƒ∞Mƒ∞ -->
        <div class="section">
            <div class="section-header ana">
                <h2>KATEGORƒ∞ 2: Medya Alƒ±≈ükanlƒ±klarƒ± ve Eri≈üimi (Soru 11-13)</h2>
                <span class="time">~10 dakika</span>
            </div>
            <div class="section-content">

                <!-- SORU 11 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">11</span>
                        <span class="main">Bo≈ü zamanlarƒ±nƒ±zda neler yaparsƒ±nƒ±z? (sanat, spor, k√ºlt√ºr, gezi/seyahat, eƒülence vb.)</span>
                        <button class="timestamp-btn" onclick="addTimestamp(11)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q11"></div>
                    <div class="probe">
                        <ul>
                            <li>Sanatƒ±n bir dalƒ±yla ilgilenir misiniz?</li>
                            <li>M√ºzik/Radyo/Podcast dinliyorsa, ne t√ºr? Belirli dinlediƒüi programlar var mƒ±?</li>
                            <li>Kitap (hangi t√ºr kitaplar, ≈üu sƒ±ralar okumakta olduƒüunuz bir kitap/roman var mƒ±?)</li>
                            <li>Takip ettiƒüi diziler ve mecralarƒ±</li>
                            <li>Takip ettiƒüiniz TV kanallarƒ±</li>
                            <li>Filmler</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 12 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">12</span>
                        <span class="main">Son bir ay i√ßinde gittiƒüiniz k√ºlt√ºrel etkinlikler var mƒ±? (Tiyatro, sergi, m√ºze, opera, halk ≈üenliƒüi gibi)</span>
                        <button class="timestamp-btn" onclick="addTimestamp(12)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q12"></div>
                </div>

                <!-- SORU 13 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">13</span>
                        <span class="main">≈ûu anda nerede ya≈üƒ±yorsunuz? ≈ûu an ya≈üadƒ±ƒüƒ±nƒ±z yerde sinema/k√ºlt√ºr mek√¢nlarƒ±na eri≈üim nasƒ±l?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(13)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q13"></div>
                    <div class="probe">
                        <ul>
                            <li>Yakƒ±n √ßevrede baƒüƒ±msƒ±z salon/k√ºlt√ºr merkezi var mƒ±?</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- B√ñL√úM 3: Sƒ∞NEMA DENEYƒ∞Mƒ∞ VE KAVRAYI≈ûI -->
        <div class="section">
            <div class="section-header derinlestirme">
                <h2>KATEGORƒ∞ 3: Sinema Deneyimi ve Kavrayƒ±≈üƒ± (Soru 14-31)</h2>
                <span class="time">~35 dakika</span>
            </div>
            <div class="section-content">

                <!-- SORU 14 -->
                <div class="question" style="margin-top: 20px;">
                    <div class="question-text">
                        <span class="question-number">14</span>
                        <span class="main">Sinemaya dair ilginiz nasƒ±l geli≈üti?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(14)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q14"></div>
                    <div class="probe">
                        <ul>
                            <li>ƒ∞lk kez ka√ß ya≈üƒ±nda sinema salonunda film izlemeye gitmi≈ütiniz? Hangi film, hangi salon, kiminle? Deneyimlerinizi payla≈üƒ±r mƒ±sƒ±nƒ±z? Sizde bƒ±raktƒ±ƒüƒ± duygu?</li>
                            <li>√áocukluƒüunuzda ve gen√ßliƒüinizde evde film izleme k√ºlt√ºr√º var mƒ±ydƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 15 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">15</span>
                        <span class="main">Sinema sizin i√ßin ne ifade eder? Film izlemek sizin i√ßin ne demek? (Merak, √∂ƒürenmek, duygusal deneyim, entelekt√ºel haz gibi)</span>
                        <button class="timestamp-btn" onclick="addTimestamp(15)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q15"></div>
                </div>

                <!-- SORU 16 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">16</span>
                        <span class="main">Bir filmi se√ßerken neye g√∂re se√ßersiniz? Bir filmi izlemeyi se√ßmenizde hangi etmenler rol oynar? Neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(16)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q16"></div>
                    <div class="probe">
                        <ul>
                            <li>Y√∂netmen/t√ºr/ele≈ütiri/arkada≈ü/algoritma?</li>
                            <li>G√ºvendiƒüiniz bir kaynak/ki≈üi/mecra var mƒ±? Yerli/yabancƒ± filmler?</li>
                            <li>Pop√ºler/arthouse/sanat film tercihleri vs.</li>
                            <li>Belli √ºlke yapƒ±mlarƒ±?</li>
                            <li>Ortam (sinema salonu, ev, festival, m√ºze, k√ºlt√ºr merkezleri)?</li>
                            <li>Yabancƒ± ise Dublajlƒ±/Altyazƒ±lƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 17 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">17</span>
                        <span class="main">Filmleri izlerken daha √ßok hangi teknolojik ara√ßlarƒ± kullanƒ±rsƒ±nƒ±z? (Tablet, telefon, TV) Neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(17)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q17"></div>
                    <div class="probe">
                        <ul>
                            <li>Seyahat halindeyken film izler misiniz? (u√ßak/tren/otob√ºs ve toplu ta≈üƒ±ma) Filmin t√ºr√º, kullanƒ±lan ara√ß, deneyimin kendisine dair a√ßƒ±klama</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 18 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">18</span>
                        <span class="main">Filmleri yalnƒ±z mƒ± birileriyle mi izlemeyi tercih edersiniz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(18)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q18"></div>
                    <div class="probe">
                        <ul>
                            <li>Daha √ßok kiminle, hangi durumlarda deƒüi≈üiyor?</li>
                            <li>En son izlediƒüiniz filmi yalnƒ±z mƒ± yoksa birileriyle mi izlediniz? Kiminle?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 19 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">19</span>
                        <span class="main">Genelde nerelerde (AVM, a√ßƒ±k hava, k√ºlt√ºr merkezi, m√ºze, vb.) film g√∂sterilerine katƒ±lƒ±rsƒ±nƒ±z? Neden buralarƒ± tercih edersiniz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(19)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q19"></div>
                    <div class="probe">
                        <ul>
                            <li>Bu g√∂sterim yerlerini √∂rnekler misiniz? √ñrneƒüin hangi sinema salonu, a√ßƒ±k hava g√∂sterimi, m√ºze, k√ºlt√ºr merkezinde ne izlemi≈ütiniz?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 20 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">20</span>
                        <span class="main">√ñzellikle tercih ettiƒüiniz bir salon var mƒ±? Neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(20)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q20"></div>
                </div>

                <!-- SORU 21 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">21</span>
                        <span class="main">En son ne zaman hangi sinema salonunda film izlediniz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(21)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q21"></div>
                </div>

                <!-- SORU 22 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">22</span>
                        <span class="main">Sinemaya gitmeden √∂nce veya sonrasƒ±nda yaptƒ±ƒüƒ±nƒ±z etkinlikler var mƒ±?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(22)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q22"></div>
                    <div class="probe">
                        <ul>
                            <li>Yemek yemek</li>
                            <li>Alƒ±≈üveri≈ü</li>
                            <li>Arkada≈ülarla bulu≈üma</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 23 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">23</span>
                        <span class="main">Sinema salonu dƒ±≈üƒ±nda ilk kez hangi mecralarda -video, dijital platformlarda, internet sitesinde, korsan olarak- ka√ß ya≈üƒ±nda film izlediƒüinizi anƒ±msƒ±yor musunuz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(23)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q23"></div>
                    <div class="probe">
                        <ul>
                            <li>Anƒ±msƒ±yorsa: Hangi mecrada, ne izlemi≈ütiniz? Nasƒ±l deneyimlemi≈ütiniz?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 24 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">24</span>
                        <span class="main">Abonesi/√ºyesi olduƒüunuz video platformlarƒ± (Netflix, HBO Max gibi) neler? Neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(24)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q24"></div>
                    <div class="probe">
                        <ul>
                            <li>Daha √ßok hangi platformlardan film izliyorsunuz?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 25 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">25</span>
                        <span class="main">Sinema salonu ve ev dƒ±≈üƒ±nda film izlediƒüiniz bir yer var mƒ±? Evetse, a√ßƒ±klayƒ±nƒ±z.</span>
                        <button class="timestamp-btn" onclick="addTimestamp(25)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q25"></div>
                </div>

                <!-- SORU 26 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">26</span>
                        <span class="main">Kendi sinema deneyiminizi nasƒ±l tarif edersiniz? Sizin i√ßin film izlemenin, sinemaya gitmenin -film hakkƒ±nda konu≈ümanƒ±n- √∂nemi/anlamƒ± nedir?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(26)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q26"></div>
                    <div class="probe">
                        <ul>
                            <li>Film hakkƒ±nda yorum/payla≈üƒ±m yapar mƒ±sƒ±nƒ±z? (nerede, neden?) En son hangi film √ºzerine hangi mecrada yorum yapmƒ±≈ütƒ±nƒ±z? Sizi yorum yapmaya y√∂nlendiren nedenler nelerdi?</li>
                            <li>√úyesi olduƒüunuz bir film kul√ºb√º veya film topluluƒüu var mƒ±? Hangisi? Bu kul√ºbe veya topluluƒüa √ºye olmanƒ±n sizin i√ßin anlamƒ± ve √∂nemi nedir?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 27 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">27</span>
                        <span class="main">Sinema zevkinizin zamanla deƒüi≈ütiƒüini d√º≈ü√ºn√ºyor musunuz? Ne zaman? Neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(27)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q27"></div>
                    <div class="probe">
                        <ul>
                            <li>Sinema deneyiminizi ve sinemaya bakƒ±≈ü a√ßƒ±nƒ±zƒ± etkileyen ve/ya deƒüi≈ütiren spesifik bir an/olay var mƒ±?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 28 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">28</span>
                        <span class="main">Film beƒüeninizin sizi ba≈ükalarƒ±ndan (√ßevrenizdekilerden?) ayƒ±rdƒ±ƒüƒ±nƒ± d√º≈ü√ºn√ºyor musunuz? Film zevkinizin √ßevrenizdekilerden farklƒ± olduƒüunu d√º≈ü√ºnd√ºƒü√ºn√ºz oluyor mu?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(28)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q28"></div>
                    <div class="probe">
                        <ul>
                            <li>Bir filmin iyi olduƒüunu nasƒ±l anlarsƒ±nƒ±z?</li>
                            <li>En son arkada≈üƒ±nƒ±za tavsiye ettiƒüiniz bir film var mƒ±? Varsa neydi? Neden tavsiye etmi≈ütiniz?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 29 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">29</span>
                        <span class="main">Festivalde film izler misiniz? Bu festivale gitmenin sizin i√ßin anlamƒ± ve √∂nemi nedir? Hangi festivalleri takip edersiniz? (Fiziksel/√áevrimi√ßi)</span>
                        <button class="timestamp-btn" onclick="addTimestamp(29)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q29"></div>
                    <div class="probe">
                        <ul>
                            <li>Festival filmleri / sanat filmleri sizce kime hitap eder?</li>
                        </ul>
                    </div>
                </div>

                <!-- SORU 30 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">30</span>
                        <span class="main">Sizin i√ßin sinefil ne anlama geliyor? Kendinizi sinefil olarak tanƒ±mlƒ±yor musunuz? Neden?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(30)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q30"></div>
                </div>

                <!-- SORU 31 -->
                <div class="question">
                    <div class="question-text">
                        <span class="question-number">31</span>
                        <span class="main">Eklemek istediƒüiniz bir ≈üey var mƒ±?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(31)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q31"></div>
                </div>
            </div>
        </div>

        <!-- EK DERƒ∞NLE≈ûTƒ∞RME SORULARI -->
        <div class="section">
            <div class="section-header" style="background: linear-gradient(90deg, #6c3483, #8e44ad);">
                <h2>üî¨ EK DERƒ∞NLE≈ûTƒ∞RME SORULARI (Ara≈ütƒ±rmacƒ± √ñnerisi)</h2>
                <span class="time">ƒ∞steƒüe Baƒülƒ±</span>
            </div>
            <div class="section-content">

                <!-- EK SORU 1: Beƒüeni Dili -->
                <div class="question" style="margin-top: 20px; border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E1</span>
                        <span class="main">Bir filmin "iyi" olduƒüuna nasƒ±l karar verirsiniz? Son izlediƒüiniz ve beƒüendiƒüiniz bir filmi neden beƒüendiniz, anlatƒ±r mƒ±sƒ±nƒ±z?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(32)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q32"></div>
                    <div class="connection-note">
                        <strong>Anket Baƒülantƒ±sƒ±:</strong> S6'da film tercihleri var ama "neden" sorusu yok. Bu soru o bo≈üluƒüu doldurur.
                    </div>
                </div>

                <!-- EK SORU 2: Gizli Beƒüeniler -->
                <div class="question" style="border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E2</span>
                        <span class="main">Bazen izlediƒüiniz halde ba≈ükalarƒ±na pek s√∂ylemediƒüiniz, biraz mahcup olduƒüunuz filmler veya diziler oluyor mu? Mesela arkada≈ülarƒ±nƒ±zla film konu≈üurken "bunu da izledim aslƒ±nda" diye s√∂yleyemediƒüiniz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(33)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q33"></div>
                    <div class="probe">
                        <ul>
                            <li>Bu i√ßerikleri neden "gizli" tutuyorsunuz? Kimden, neden?</li>
                            <li>Arkada≈ü ortamƒ±nda film √∂nerirken bu filmleri s√∂yler misiniz?</li>
                            <li>Bu t√ºr i√ßerikleri izlerken kendinizi nasƒ±l hissediyorsunuz?</li>
                            <li>"Kaliteli" ve "kalitesiz" film ayrƒ±mƒ±nƒ± neye g√∂re yapƒ±yorsunuz?</li>
                        </ul>
                    </div>
                </div>

                <!-- EK SORU 3: Mekan Aidiyeti -->
                <div class="question" style="border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E3</span>
                        <span class="main">Hi√ß bir sinema salonunda veya film etkinliƒüinde kendinizi "yabancƒ±" veya "yerinde deƒüilmi≈ü" gibi hissettiniz mi? Ya da tam tersi, "burasƒ± benim yerim" dediƒüiniz mekanlar var mƒ±?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(34)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q34"></div>
                    <div class="connection-note">
                        <strong>Anket Baƒülantƒ±sƒ±:</strong> D58'de gittiƒüi mekanlar var ama orada nasƒ±l hissettiƒüi yok.
                    </div>
                </div>

                <!-- EK SORU 4: T√ºrk Sinemasƒ± -->
                <div class="question" style="border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E4</span>
                        <span class="main">T√ºrk filmlerini nasƒ±l deƒüerlendiriyorsunuz? T√ºrk sinemasƒ±nda beƒüendiƒüiniz y√∂netmenler veya filmler var mƒ±? T√ºrk filmi izlerken farklƒ± bir deneyim ya≈üƒ±yor musunuz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(35)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q35"></div>
                    <div class="probe">
                        <ul>
                            <li>Yerli vs yabancƒ± film tercihi ve nedenleri</li>
                            <li>T√ºrk baƒüƒ±msƒ±z sinemasƒ± farkƒ±ndalƒ±ƒüƒ± (Nuri Bilge Ceylan, Zeki Demirkubuz, vb.)</li>
                            <li>Ye≈üil√ßam nostaljisi var mƒ±?</li>
                            <li>T√ºrk filmi izlerken "tanƒ±ma" veya "yabancƒ±la≈üma" hissi</li>
                        </ul>
                    </div>
                    <div class="connection-note">
                        <strong>Proje Baƒülantƒ±sƒ±:</strong> "Cumhuriyetin 100. Yƒ±lƒ±nda Sinema Seyircisi" - ulusal sinema algƒ±sƒ± kritik.
                    </div>
                </div>

                <!-- EK SORU 5: Sosyal Medya -->
                <div class="question" style="border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E5</span>
                        <span class="main">ƒ∞zlediƒüiniz filmleri sosyal medyada payla≈üƒ±r mƒ±sƒ±nƒ±z? Letterboxd, Instagram, Twitter/X'te film hakkƒ±nda post atar mƒ±sƒ±nƒ±z? Neden evet/hayƒ±r?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(36)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q36"></div>
                </div>

                <!-- EK SORU 6: Ku≈üaklararasƒ± Aktarƒ±m -->
                <div class="question" style="border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E6</span>
                        <span class="main">Ailenizden biri size √∂zellikle "bunu izle" diye film √∂nerdi mi? Sinema zevkinizi ≈üekillendiren bir aile √ºyesi var mƒ±? Yoksa tamamen kendiniz mi ke≈üfettiniz?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(37)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q37"></div>
                    <div class="connection-note">
                        <strong>Anket Baƒülantƒ±sƒ±:</strong> K1'de aile k√ºlt√ºrel aktiviteleri var ama aktif aktarƒ±m sorulmamƒ±≈ü.
                    </div>
                </div>

                <!-- EK SORU 7: Pandemi Kalƒ±cƒ±lƒ±ƒüƒ± -->
                <div class="question" style="border-left: 4px solid #9b59b6; padding-left: 15px;">
                    <div class="question-text">
                        <span class="question-number" style="background: #6c3483;">E7</span>
                        <span class="main">Pandemi √∂ncesi ve sonrasƒ± sinema alƒ±≈ükanlƒ±klarƒ±nƒ±zƒ± kar≈üƒ±la≈ütƒ±rƒ±r mƒ±sƒ±nƒ±z? Kalƒ±cƒ± olarak deƒüi≈üen bir ≈üey var mƒ±? Sinema salonuna geri d√∂nme motivasyonunuz ne?</span>
                        <button class="timestamp-btn" onclick="addTimestamp(38)">+ Zaman</button>
                    </div>
                        <div class="timestamps-list" id="timestamps-q38"></div>
                    <div class="probe">
                        <ul>
                            <li>Ev izleme alƒ±≈ükanlƒ±ƒüƒ± kalƒ±cƒ± mƒ± oldu?</li>
                            <li>Sinema salonu deneyiminin "vazge√ßilmezliƒüi" var mƒ±?</li>
                            <li>Platform abonelikleri pandemiyle mi ba≈üladƒ±?</li>
                            <li>Sosyal izleme ihtiyacƒ± deƒüi≈üti mi?</li>
                        </ul>
                    </div>
                </div>



                <div class="form-field" style="margin-top: 20px;">
                    <label style="font-size: 14px; font-weight: 600; color: #555; text-transform: uppercase; margin-bottom: 8px; display: block;">Genel Notlar / G√∂zlemler</label>
                    <textarea id="general-notes" placeholder="G√∂r√º≈üme hakkƒ±nda genel notlar, katƒ±lƒ±mcƒ± izlenimleri vb." style="width: 100%; min-height: 100px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"></textarea>
                </div>

                <div class="checklist">
                    <h4>‚úÖ G√∂r√º≈üme Sonu Kontrol Listesi</h4>
                    <label><input type="checkbox"> Kayƒ±t durduruldu</label>
                    <label><input type="checkbox"> T√ºm√º indirildi (WAV, TXT, JSON)</label>
                    <div id="driveUploadStatus" style="margin-top: 8px; font-size: 12px; color: #7f8c8d;"></div>
                </div>

                <div class="action-buttons" style="margin-top: 18px;">
                    <button class="btn btn-save" onclick="saveForm()">Kaydet</button>
                    <button class="btn btn-clear" onclick="clearForm()">Temizle</button>
                    <button class="btn btn-edit" id="editModeBtn" onclick="toggleEditMode()">‚úèÔ∏è D√ºzenleme Modu</button>
                </div>
            </div>
        </div>
        <div class="footer">
            T√úBƒ∞TAK 1001 - Cumhuriyetin 100. Yƒ±lƒ±nda Sinema Seyircisi Ara≈ütƒ±rmasƒ±<br>
            Derinlemesine G√∂r√º≈üme Soru Formu | 31 Temel + 7 Ek Soru, D√ºzenlenebilir
        </div>
    </div>

    <script>
        // SES KAYDI DEƒûƒ∞≈ûKENLERƒ∞
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime = null;
        let timerInterval = null;
        let recordings = [];
        let timestamps = {};
        let backupInterval = null;
        let lastPdfBlob = null; // Drive y√ºkleme i√ßin PDF blob
        let dbReady = false;
        let db = null;

        // Mikrofon stream
        let micStream = null;

        // Raw PCM yakalama (g√ºvenilir WAV d√∂n√º≈ü√ºm√º i√ßin - WebM decode atlanƒ±r)
        let pcmChunks = [];
        let pcmSampleRate = 0;
        let pcmCaptureNode = null;
        let pcmAudioContext = null;

        // CANLI DE≈ûƒ∞FRE DEƒûƒ∞≈ûKENLERƒ∞
        let speechRecognition = null;
        let transcriptData = {
            meta: {},
            transkript: [],
            markerlar: [],
            sorular: []
        };
        let transcriptSegmentId = 0;
        let currentActiveQuestion = null;
        let transcriptPanelMinimized = false;

        // IndexedDB kurulumu (b√ºy√ºk ses dosyalarƒ± i√ßin)
        const dbRequest = indexedDB.open('DerinlemesineGorusmeDB', 1);
        dbRequest.onerror = () => console.warn('IndexedDB a√ßƒ±lamadƒ±, yedekleme devre dƒ±≈üƒ±');
        dbRequest.onsuccess = (e) => {
            db = e.target.result;
            dbReady = true;
            console.log('IndexedDB hazƒ±r - otomatik yedekleme aktif');
            checkForRecovery(); // Kurtarƒ±lacak kayƒ±t var mƒ± kontrol et
        };
        dbRequest.onupgradeneeded = (e) => {
            const database = e.target.result;
            if (!database.objectStoreNames.contains('audioBackups')) {
                database.createObjectStore('audioBackups', { keyPath: 'id' });
            }
        };

        // Ses kaydƒ±nƒ± IndexedDB'ye yedekle
        async function backupAudioToIndexedDB() {
            if (!dbReady || !db || audioChunks.length === 0) return;

            try {
                const backupBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const transaction = db.transaction(['audioBackups'], 'readwrite');
                const store = transaction.objectStore('audioBackups');

                const backupData = {
                    id: 'currentRecording',
                    blob: backupBlob,
                    timestamp: new Date().toISOString(),
                    duration: document.getElementById('recordingTimer').textContent,
                    participantName: document.getElementById('participant-name').value,
                    focusGroup: document.getElementById('focus-group').value,
                    markers: JSON.parse(JSON.stringify(timestamps))
                };

                store.put(backupData);

                transaction.oncomplete = () => {
                    showBackupNotification();
                    console.log('Otomatik yedekleme tamamlandƒ±:', backupData.duration);
                };
            } catch (err) {
                console.error('Yedekleme hatasƒ±:', err);
            }
        }

        // Yedekleme bildirimi g√∂ster
        function showBackupNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: #27ae60;
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                font-size: 13px;
                z-index: 10000;
                animation: fadeOut 3s forwards;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            notification.innerHTML = 'üíæ Otomatik yedekleme yapƒ±ldƒ±';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Kurtarƒ±lacak kayƒ±t var mƒ± kontrol et
        function checkForRecovery() {
            if (!dbReady || !db) return;

            const transaction = db.transaction(['audioBackups'], 'readonly');
            const store = transaction.objectStore('audioBackups');
            const request = store.get('currentRecording');

            request.onsuccess = (e) => {
                const backup = e.target.result;
                if (backup && backup.blob && backup.blob.size > 0) {
                    const backupTime = new Date(backup.timestamp).toLocaleString('tr-TR');
                    if (confirm(`Kurtarƒ±labilir bir kayƒ±t bulundu!\n\nTarih: ${backupTime}\nS√ºre: ${backup.duration}\nKatƒ±lƒ±mcƒ±: ${backup.participantName || 'Belirtilmedi'}\n\nBu kaydƒ± kurtarmak ister misiniz?`)) {
                        recoverBackup(backup);
                    } else {
                        clearBackup();
                    }
                }
            };
        }

        // Yedeƒüi kurtar
        function recoverBackup(backup) {
            recordings.push({
                blob: backup.blob,
                mimeType: 'audio/webm',
                name: `KURTARILAN_${backup.focusGroup || 'G0'}_${backup.participantName || 'katilimci'}_${backup.timestamp.slice(0,10)}.webm`,
                duration: backup.duration,
                size: (backup.blob.size / 1024 / 1024).toFixed(2) + ' MB'
            });

            if (backup.markers) {
                timestamps = backup.markers;
            }

            updateRecordingsList();
            clearBackup();
            alert('Kayƒ±t ba≈üarƒ±yla kurtarƒ±ldƒ±! "Kaydedilen Ses Dosyalarƒ±" b√∂l√ºm√ºnden indirebilirsiniz.');
        }

        // Yedeƒüi temizle
        function clearBackup() {
            if (!dbReady || !db) return;
            const transaction = db.transaction(['audioBackups'], 'readwrite');
            const store = transaction.objectStore('audioBackups');
            store.delete('currentRecording');
        }

        // Otomatik yedeklemeyi ba≈ülat (her 5 dakikada bir)
        function startAutoBackup() {
            if (backupInterval) clearInterval(backupInterval);
            backupInterval = setInterval(() => {
                if (isRecording) {
                    backupAudioToIndexedDB();
                    saveForm(); // Form verilerini de kaydet
                }
            }, 5 * 60 * 1000); // 5 dakika
            console.log('Otomatik yedekleme ba≈ülatƒ±ldƒ± (5 dk aralƒ±klarla)');
        }

        // Otomatik yedeklemeyi durdur
        function stopAutoBackup() {
            if (backupInterval) {
                clearInterval(backupInterval);
                backupInterval = null;
            }
        }

        // Sayfa y√ºklendiƒüinde timestamps'ƒ± ba≈ülat
        for (let i = 1; i <= 38; i++) {
            timestamps['q' + i] = [];
        }
        timestamps['general'] = [];

        // Son eklenen marker i√ßin hangi soru aktif
        let activeQuestionForMarker = 1;

        // KLAVYE KISAYOLLARI (Sadele≈ütirilmi≈ü)
        document.addEventListener('keydown', function(e) {
            // Eƒüer bir input/textarea i√ßindeyse kƒ±sayollarƒ± devre dƒ±≈üƒ± bƒ±rak
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                return;
            }

            // 1 tu≈üu - Kayƒ±t ba≈ülat (kayƒ±t yokken)
            if (e.key === '1' && !isRecording) {
                e.preventDefault();
                toggleRecording();
            }

            // 2 tu≈üu - Kayƒ±t durdur (kayƒ±t aktifken)
            if (e.key === '2' && isRecording) {
                e.preventDefault();
                toggleRecording();
            }

            // 3 tu≈üu - Marker ekle (kayƒ±t aktifken)
            if (e.key === '3' && isRecording) {
                e.preventDefault();
                addQuickMarker();
            }

            // 4 tu≈üu - Kaydet
            if (e.key === '4') {
                e.preventDefault();
                saveForm();
            }

            // 5 tu≈üu - D√ºzenleme modu
            if (e.key === '5') {
                e.preventDefault();
                toggleEditMode();
            }
        });

        // Hƒ±zlƒ± marker ekle (genel kategoriye)
        function addQuickMarker() {
            const currentTime = document.getElementById('recordingTimer').textContent;
            timestamps['general'].push({
                time: currentTime,
                note: 'Marker_' + (timestamps['general'].length + 1)
            });
            showMarkerFeedback('Genel');
            console.log('Hƒ±zlƒ± marker eklendi:', currentTime);
        }

        // Marker eklendi bildirimi
        function showMarkerFeedback(label) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 60px;
                right: 10px;
                background: #27ae60;
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                animation: fadeOut 1.5s forwards;
            `;
            feedback.textContent = '‚úì ' + label + ' - Marker eklendi';
            document.body.appendChild(feedback);
            setTimeout(() => feedback.remove(), 1500);
        }

        // CSS animasyonu ekle
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                0% { opacity: 1; transform: translateY(0); }
                70% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-10px); }
            }
        `;
        document.head.appendChild(style);

        // SES KAYDI FONKSƒ∞YONLARI

        async function toggleRecording() {
            if (!isRecording) {
                try {
                    console.log('Mikrofon eri≈üimi isteniyor...');
                    micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    console.log('Mikrofon eri≈üimi saƒülandƒ±:', micStream.getAudioTracks()[0].label);

                    // MediaRecorder olu≈ütur - desteklenen format
                    let mimeType = 'audio/webm';
                    if (!MediaRecorder.isTypeSupported('audio/webm')) {
                        mimeType = 'audio/ogg';
                    }
                    if (!MediaRecorder.isTypeSupported(mimeType)) {
                        mimeType = '';
                    }

                    const options = mimeType ? { mimeType: mimeType } : {};
                    mediaRecorder = new MediaRecorder(micStream, options);
                    audioChunks = [];

                    console.log('MediaRecorder olu≈üturuldu, format:', mediaRecorder.mimeType);

                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };

                    mediaRecorder.onstop = () => {
                        console.log('Kayƒ±t durduruluyor, toplam chunk:', audioChunks.length);

                        const audioBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType || 'audio/webm' });
                        const extension = (mediaRecorder.mimeType || '').includes('ogg') ? 'ogg' : 'webm';

                        const participantName = document.getElementById('participant-name').value || 'katilimci';
                        const focusGroup = document.getElementById('focus-group').value || 'G0';
                        const dateStr = new Date().toISOString().slice(0, 10);

                        console.log('Blob olu≈üturuldu:', {
                            size: audioBlob.size,
                            type: audioBlob.type,
                            chunks: audioChunks.length
                        });

                        if (audioBlob.size === 0) {
                            alert('Uyarƒ±: Ses kaydƒ± bo≈ü! Mikrofon d√ºzg√ºn √ßalƒ±≈ümƒ±yor olabilir.');
                            return;
                        }

                        recordings.push({
                            blob: audioBlob,
                            mimeType: mediaRecorder.mimeType,
                            name: `Derinlemesine_${focusGroup}_${participantName}_${dateStr}.${extension}`,
                            duration: document.getElementById('recordingTimer').textContent,
                            size: (audioBlob.size / 1024 / 1024).toFixed(2) + ' MB'
                        });

                        console.log('Kayƒ±t tamamlandƒ±:', {
                            mimeType: mediaRecorder.mimeType,
                            size: audioBlob.size,
                            duration: document.getElementById('recordingTimer').textContent
                        });

                        updateRecordingsList();
                        micStream.getTracks().forEach(track => track.stop());
                        micStream = null;
                    };

                    mediaRecorder.onerror = (event) => {
                        console.error('MediaRecorder hatasƒ±:', event.error);
                        alert('Kayƒ±t hatasƒ±: ' + event.error.message);
                    };

                    // Raw PCM yakalama ba≈ülat (WAV d√∂n√º≈ü√ºm√º i√ßin - ScriptProcessorNode)
                    try {
                        pcmChunks = [];
                        pcmAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                        pcmSampleRate = pcmAudioContext.sampleRate;
                        const pcmSource = pcmAudioContext.createMediaStreamSource(micStream);

                        // ScriptProcessorNode ile PCM yakalama (file:// uyumlu)
                        const bufferSize = 4096;
                        pcmCaptureNode = pcmAudioContext.createScriptProcessor(bufferSize, 1, 1);
                        pcmCaptureNode.onaudioprocess = function(e) {
                            const inputData = e.inputBuffer.getChannelData(0);
                            pcmChunks.push(new Float32Array(inputData));
                        };
                        pcmSource.connect(pcmCaptureNode);
                        pcmCaptureNode.connect(pcmAudioContext.destination);
                        console.log('PCM yakalama ba≈üladƒ± (ScriptProcessor), sampleRate:', pcmSampleRate);
                    } catch (pcmErr) {
                        console.warn('PCM yakalama ba≈ülatƒ±lamadƒ±, fallback kullanƒ±lacak:', pcmErr);
                    }

                    // Her saniye veri topla
                    mediaRecorder.start(1000);
                    isRecording = true;
                    recordingStartTime = Date.now();
                    startTimer();

                    console.log('Kayƒ±t ba≈üladƒ±!');

                    // Otomatik yedeklemeyi ba≈ülat
                    startAutoBackup();

                    document.getElementById('recordBtn').classList.add('recording');
                    document.getElementById('recordBtnText').textContent = 'Kaydƒ± Durdur';
                    document.getElementById('recDot').classList.add('active');
                    document.getElementById('floatingRecorder').classList.add('active');

                    // CANLI DE≈ûƒ∞FRE BA≈ûLAT
                    initTranscriptData();
                    document.getElementById('transcriptPanel').classList.add('active');
                    document.getElementById('transcriptBody').innerHTML = '<div style="color: #888; font-style: italic; font-size: 13px;">Konu≈üma tanƒ±ma ba≈ülatƒ±lƒ±yor...</div>';
                    startSpeechRecognition();

                } catch (err) {
                    console.error('Mikrofon hatasƒ±:', err);
                    if (micStream) {
                        micStream.getTracks().forEach(track => track.stop());
                        micStream = null;
                    }
                    alert('Mikrofon eri≈üimi reddedildi veya mikrofon bulunamadƒ±.\n\nHata: ' + err.message + '\n\nZoom kullanƒ±yorsanƒ±z, Zoom\'un kendi kayƒ±t √∂zelliƒüini kullanabilirsiniz.');
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                stopTimer();

                // PCM yakalamayƒ± durdur (veriler pcmChunks'ta kalƒ±r, indirme i√ßin)
                if (pcmCaptureNode) {
                    pcmCaptureNode.disconnect();
                    pcmCaptureNode = null;
                }
                if (pcmAudioContext) {
                    pcmAudioContext.close();
                    pcmAudioContext = null;
                }
                console.log('PCM yakalama durduruldu, chunk sayƒ±sƒ±:', pcmChunks.length);

                // Otomatik yedeklemeyi durdur ve yedeƒüi temizle
                stopAutoBackup();
                clearBackup();

                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordBtnText').textContent = 'Yeni Kayƒ±t';
                document.getElementById('recDot').classList.remove('active');
                document.getElementById('floatingRecorder').classList.remove('active');

                // CANLI DE≈ûƒ∞FREYƒ∞ DURDUR
                stopSpeechRecognition();
                // Meta s√ºresini g√ºncelle
                if (transcriptData.meta) {
                    transcriptData.meta.sure_saniye = Math.round((Date.now() - (recordingStartTime || Date.now())) / 1000);
                    transcriptData.meta.bitis_zamani = new Date().toISOString();
                }

                // OTOMATƒ∞K T√úM√úN√ú ƒ∞NDƒ∞R (WAV + TXT + JSON + PDF)
                setTimeout(() => {
                    downloadAllOnStop();
                }, 1500);
            }
        }

        // PDF Olu≈üturma Fonksiyonu
        function generatePDF() {
            const container = document.querySelector('.container');
            const participantName = document.getElementById('participant-name').value || 'katilimci';
            const focusGroup = document.getElementById('focus-group').value || 'G0';
            const dateStr = new Date().toISOString().slice(0, 10);
            const fileName = `Gorusme_${focusGroup}_${participantName.replace(/\s+/g, '_')}_${dateStr}.pdf`;

            // Ge√ßici olarak kayƒ±t b√∂l√ºm√ºn√º ve transcript panelini gizle
            const recSection = document.querySelector('.recording-section');
            const transcriptPanel = document.getElementById('transcriptPanel');
            const floatingRec = document.getElementById('floatingRecorder');
            const actionBtns = document.querySelectorAll('.action-buttons');
            const editBanner = document.getElementById('editModeBanner');

            const origDisplay = {
                rec: recSection ? recSection.style.display : '',
                tp: transcriptPanel ? transcriptPanel.style.display : '',
                fr: floatingRec ? floatingRec.style.display : '',
                eb: editBanner ? editBanner.style.display : ''
            };

            if (recSection) recSection.style.display = 'none';
            if (transcriptPanel) transcriptPanel.style.display = 'none';
            if (floatingRec) floatingRec.style.display = 'none';
            if (editBanner) editBanner.style.display = 'none';
            actionBtns.forEach(el => el.style.display = 'none');

            html2canvas(container, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#f5f5f5',
                logging: false,
                windowWidth: 900
            }).then(function(canvas) {
                var jsPDF = window.jspdf.jsPDF;
                var pdf = new jsPDF('p', 'mm', 'a4');
                var pageW = pdf.internal.pageSize.getWidth();
                var pageH = pdf.internal.pageSize.getHeight();
                var margin = 10;
                var imgW = pageW - margin * 2;
                var imgH = (canvas.height * imgW) / canvas.width;

                if (imgH <= pageH - margin * 2) {
                    pdf.addImage(canvas.toDataURL('image/jpeg', 0.85), 'JPEG', margin, margin, imgW, imgH);
                } else {
                    var pos = 0;
                    var page = 0;
                    while (pos < imgH) {
                        if (page > 0) pdf.addPage();
                        var usable = pageH - margin * 2;
                        var srcY = (pos / imgH) * canvas.height;
                        var srcH = Math.min((usable / imgH) * canvas.height, canvas.height - srcY);
                        var tmpC = document.createElement('canvas');
                        tmpC.width = canvas.width;
                        tmpC.height = srcH;
                        tmpC.getContext('2d').drawImage(canvas, 0, srcY, canvas.width, srcH, 0, 0, canvas.width, srcH);
                        var drawH = (srcH * imgW) / canvas.width;
                        pdf.addImage(tmpC.toDataURL('image/jpeg', 0.85), 'JPEG', margin, margin, imgW, drawH);
                        pos += usable;
                        page++;
                    }
                }

                lastPdfBlob = pdf.output('blob');
                pdf.save(fileName);
                console.log('PDF otomatik indirildi:', fileName);

                // Gizlenen elemanlarƒ± geri getir
                if (recSection) recSection.style.display = origDisplay.rec;
                if (transcriptPanel) transcriptPanel.style.display = origDisplay.tp;
                if (floatingRec) floatingRec.style.display = origDisplay.fr;
                if (editBanner) editBanner.style.display = origDisplay.eb;
                actionBtns.forEach(el => el.style.display = '');

            }).catch(function(err) {
                console.error('PDF olu≈üturma hatasƒ±:', err);
                // Gizlenen elemanlarƒ± geri getir
                if (recSection) recSection.style.display = origDisplay.rec;
                if (transcriptPanel) transcriptPanel.style.display = origDisplay.tp;
                if (floatingRec) floatingRec.style.display = origDisplay.fr;
                if (editBanner) editBanner.style.display = origDisplay.eb;
                actionBtns.forEach(el => el.style.display = '');
            });
        }

        // Kayƒ±t durdurulunca hepsini sƒ±rayla indir
        function downloadAllOnStop() {
            if (recordings.length === 0) return;
            const idx = recordings.length - 1;

            // 1. WAV indir (0s)
            console.log('=== OTOMATƒ∞K ƒ∞NDƒ∞RME BA≈ûLIYOR ===');
            downloadRecording(idx);

            // 2. TXT indir (2s)
            setTimeout(() => {
                if (transcriptData.transkript.length > 0) {
                    downloadTranscriptTXT();
                }
            }, 2000);

            // 3. JSON indir (4s)
            setTimeout(() => {
                if (transcriptData.transkript.length > 0) {
                    // Marker'larƒ± JSON'a ekle
                    transcriptData.markerlar = [];
                    if (timestamps['general']) {
                        timestamps['general'].forEach(ts => {
                            transcriptData.markerlar.push({ zaman: ts.time, etiket: ts.note || 'Marker' });
                        });
                    }
                    for (let i = 1; i <= 38; i++) {
                        const key = 'q' + i;
                        if (timestamps[key] && timestamps[key].length > 0) {
                            timestamps[key].forEach(ts => {
                                const timeStr = typeof ts === 'string' ? ts : ts.time;
                                const noteStr = typeof ts === 'string' ? '' : (ts.note || '');
                                transcriptData.markerlar.push({ zaman: timeStr, etiket: 'S' + i + '_' + (noteStr || 'Marker') });
                            });
                        }
                    }
                    downloadTranscriptJSON();
                }
            }, 4000);

            // 4. PDF indir (6s)
            setTimeout(() => {
                generatePDF();
            }, 6000);

            // 5. Drive'a y√ºkle (10s - PDF hazƒ±r olsun diye bekle)
            setTimeout(() => {
                uploadToDrive();
            }, 10000);
        }

        // =============================================
        // GOOGLE DRIVE Y√úKLEME
        // =============================================
        const DRIVE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyQ9U0BLadvrmmreYRa6sq4qc_vtlRpCamKiviQ9EbTzaBUBeJtQ5JuJFeiS96-0c4-5w/exec';

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        async function uploadToDrive() {
            console.log('=== DRIVE Y√úKLEME BA≈ûLIYOR ===');
            const participantName = document.getElementById('participant-name').value || 'katilimci';
            const focusGroup = document.getElementById('focus-group').value || 'G0';
            const dateStr = new Date().toISOString().slice(0, 10);
            const folderName = `${focusGroup}_${participantName.replace(/\s+/g, '_')}_${dateStr}`;
            console.log('Klas√∂r adƒ±:', folderName);

            const statusEl = document.getElementById('driveUploadStatus');
            if (statusEl) {
                statusEl.textContent = '‚è≥ Drive\'a y√ºkleniyor...';
                statusEl.style.color = '#e67e22';
            }

            var filesToUpload = [];

            try {
                // 1. WebM ses dosyasƒ± (k√º√ß√ºk boyut)
                if (recordings.length > 0) {
                    const rec = recordings[recordings.length - 1];
                    const audioBase64 = await blobToBase64(rec.blob);
                    filesToUpload.push({
                        fileName: rec.name,
                        mimeType: rec.blob.type || 'audio/webm',
                        data: audioBase64
                    });
                }

                // 2. TXT de≈üifre
                if (transcriptData.transkript.length > 0) {
                    const txtContent = generateTXTContent();
                    const txtBlob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
                    const txtBase64 = await blobToBase64(txtBlob);
                    filesToUpload.push({
                        fileName: `Desifre_${participantName.replace(/\s+/g, '_')}_${dateStr}.txt`,
                        mimeType: 'text/plain',
                        data: txtBase64
                    });
                }

                // 3. JSON de≈üifre
                if (transcriptData.transkript.length > 0) {
                    const jsonStr = JSON.stringify(transcriptData, null, 2);
                    const jsonBlob = new Blob([jsonStr], { type: 'application/json;charset=utf-8' });
                    const jsonBase64 = await blobToBase64(jsonBlob);
                    filesToUpload.push({
                        fileName: `Desifre_${participantName.replace(/\s+/g, '_')}_${dateStr}.json`,
                        mimeType: 'application/json',
                        data: jsonBase64
                    });
                }

                // 4. PDF
                if (lastPdfBlob) {
                    const pdfBase64 = await blobToBase64(lastPdfBlob);
                    filesToUpload.push({
                        fileName: `Gorusme_${focusGroup}_${participantName.replace(/\s+/g, '_')}_${dateStr}.pdf`,
                        mimeType: 'application/pdf',
                        data: pdfBase64
                    });
                }

                if (filesToUpload.length === 0) {
                    console.log('Drive\'a y√ºklenecek dosya yok');
                    if (statusEl) {
                        statusEl.textContent = '‚ö†Ô∏è Y√ºklenecek dosya yok';
                        statusEl.style.color = '#e74c3c';
                    }
                    return;
                }

                console.log('Drive\'a y√ºkleniyor:', filesToUpload.length, 'dosya, klas√∂r:', folderName);

                await fetch(DRIVE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        folderName: folderName,
                        files: filesToUpload
                    })
                });

                console.log('Drive y√ºkleme isteƒüi g√∂nderildi');
                if (statusEl) {
                    statusEl.innerHTML = '‚úÖ Drive\'a y√ºklendi ‚Äî <a href="https://drive.google.com" target="_blank" style="color:#1abc9c;">Drive\'ƒ± a√ß</a>';
                    statusEl.style.color = '#27ae60';
                }

            } catch (error) {
                console.error('Drive y√ºkleme hatasƒ±:', error);
                if (statusEl) {
                    statusEl.textContent = '‚ùå Drive baƒülantƒ± hatasƒ±';
                    statusEl.style.color = '#e74c3c';
                }
            }
        }

        // TXT i√ßeriƒüi olu≈ütur (indirme ve Drive y√ºkleme i√ßin ortak)
        function generateTXTContent() {
            const m = transcriptData.meta;
            let txt = '';
            txt += '============================================================\n';
            txt += '         DE≈ûƒ∞FRE METNƒ∞ - DERƒ∞NLEMESƒ∞NE G√ñR√ú≈ûME\n';
            txt += '         T√úBƒ∞TAK 1001 Sinema Seyircisi Ara≈ütƒ±rmasƒ±\n';
            txt += '============================================================\n\n';
            txt += 'Katƒ±lƒ±mcƒ±     : ' + (m.katilimci || '-') + '\n';
            txt += 'G√∂r√º≈ümeci     : ' + (m.gorusmeci || '-') + '\n';
            txt += 'Odak Grup     : ' + (m.odak_grup || '-') + '\n';
            txt += 'Tarih         : ' + (m.tarih || '-') + '\n';
            txt += 'Saat          : ' + (m.saat || '-') + '\n';
            txt += 'Toplam S√ºre   : ' + formatDuration(m.sure_saniye || 0) + '\n';
            txt += 'Ses Dosyasƒ±   : ' + (m.ses_dosyasi || '-') + '\n';
            txt += 'Sistem Sesi   : ' + (m.sistem_sesi ? 'Evet (Zoom)' : 'Hayƒ±r') + '\n';
            txt += 'Toplam Segment: ' + transcriptData.transkript.length + '\n';
            txt += '\n------------------------------------------------------------\n';
            txt += '  G√ñR√ú≈ûME METNƒ∞\n';
            txt += '------------------------------------------------------------\n\n';

            let lastQuestion = null;
            transcriptData.transkript.forEach((seg) => {
                if (seg.soru_no && seg.soru_no !== lastQuestion) {
                    txt += '\n  --- Soru ' + seg.soru_no + ' ---\n\n';
                    lastQuestion = seg.soru_no;
                }
                txt += '[' + seg.zaman + ']  ' + seg.metin + '\n';
            });

            if (transcriptData.markerlar && transcriptData.markerlar.length > 0) {
                txt += '\n------------------------------------------------------------\n';
                txt += '  ZAMAN DAMGALARI / MARKER\'LAR\n';
                txt += '------------------------------------------------------------\n\n';
                transcriptData.markerlar.forEach((mk) => {
                    txt += '[' + mk.zaman + ']  ' + mk.etiket + '\n';
                });
            }

            txt += '\n============================================================\n';
            txt += 'Bu dosya Web Speech API ile otomatik olu≈üturulmu≈ütur.\n';
            txt += 'Doƒüruluk kontrol√º yapƒ±lmasƒ± √∂nerilir.\n';
            txt += 'Olu≈üturma: ' + new Date().toLocaleString('tr-TR') + '\n';
            txt += '============================================================\n';

            return txt;
        }

        // =============================================
        // CANLI DE≈ûƒ∞FRE Sƒ∞STEMƒ∞ (Web Speech API)
        // =============================================

        function initTranscriptData() {
            const participantName = document.getElementById('participant-name').value || 'katilimci';
            const focusGroup = document.getElementById('focus-group').value || 'G0';
            const interviewDate = document.getElementById('interview-date').value || new Date().toISOString().slice(0, 10);

            transcriptData = {
                meta: {
                    form: 'derinlemesine_gorusme',
                    katilimci: participantName,
                    gorusmeci: document.getElementById('interviewer-name').value || '',
                    odak_grup: focusGroup,
                    tarih: interviewDate,
                    saat: document.getElementById('interview-time').value || '',
                    baslangic_zamani: new Date().toISOString(),
                    sure_saniye: 0,
                    ses_dosyasi: `Derinlemesine_${focusGroup}_${participantName}_${interviewDate}.wav`,
                    dil: 'tr-TR',
                    tarayici: navigator.userAgent.match(/Chrome|Firefox|Safari|Edge/)?.[0] || 'Bilinmiyor',
                    sistem_sesi: false
                },
                transkript: [],
                markerlar: [],
                sorular: []
            };
            transcriptSegmentId = 0;
        }

        // =============================================
        // CANLI DE≈ûƒ∞FRE Sƒ∞STEMƒ∞ (Web Speech API)
        // =============================================

        function startSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                console.warn('Web Speech API desteklenmiyor');
                document.getElementById('transcriptStatus').textContent = 'Tarayƒ±cƒ± desteklemiyor';
                return;
            }

            speechRecognition = new SpeechRecognition();
            speechRecognition.lang = 'tr-TR';
            speechRecognition.continuous = true;
            speechRecognition.interimResults = true;
            speechRecognition.maxAlternatives = 1;

            let interimDiv = null;

            speechRecognition.onstart = () => {
                console.log('Konu≈üma tanƒ±ma ba≈üladƒ± (mikrofon)');
                document.getElementById('transcriptDot').classList.add('listening');
                document.getElementById('transcriptStatus').textContent = 'Dinliyor...';
            };

            speechRecognition.onresult = (event) => {
                const currentTime = document.getElementById('recordingTimer').textContent;
                const elapsed = recordingStartTime ? (Date.now() - recordingStartTime) / 1000 : 0;

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    const text = result[0].transcript.trim();
                    const rawConf = result[0].confidence;
                    const confidence = (rawConf === 0 && result.isFinal) ? 0.85 : rawConf;

                    if (result.isFinal) {
                        if (text.length > 0) {
                            transcriptSegmentId++;
                            const segment = {
                                id: transcriptSegmentId,
                                baslangic: parseFloat(elapsed.toFixed(1)),
                                zaman: currentTime,
                                metin: text,
                                guven: parseFloat(confidence.toFixed(2)),
                                soru_no: currentActiveQuestion,
                                final: true
                            };
                            transcriptData.transkript.push(segment);
                            addTranscriptLine(currentTime, text, confidence, true);
                        }
                        if (interimDiv) {
                            interimDiv.remove();
                            interimDiv = null;
                        }
                    } else {
                        if (!interimDiv) {
                            interimDiv = document.createElement('div');
                            interimDiv.className = 'transcript-line';
                            document.getElementById('transcriptBody').appendChild(interimDiv);
                        }
                        interimDiv.innerHTML = `<span class="tl-time">${currentTime}</span><span class="tl-interim">${text}...</span>`;
                        scrollTranscript();
                    }
                }
            };

            speechRecognition.onerror = (event) => {
                console.warn('Konu≈üma tanƒ±ma hatasƒ±:', event.error);
                if (event.error === 'no-speech') {
                    document.getElementById('transcriptStatus').textContent = 'Ses algƒ±lanmƒ±yor...';
                } else if (event.error === 'network') {
                    document.getElementById('transcriptStatus').textContent = 'ƒ∞nternet baƒülantƒ±sƒ± gerekli';
                }
            };

            speechRecognition.onend = () => {
                if (isRecording && speechRecognition) {
                    setTimeout(() => {
                        if (isRecording && speechRecognition) {
                            try { speechRecognition.start(); } catch (e) {
                                console.warn('De≈üifre yeniden ba≈ülatƒ±lamadƒ±:', e.message);
                            }
                        }
                    }, 1000);
                } else {
                    document.getElementById('transcriptDot').classList.remove('listening');
                    document.getElementById('transcriptStatus').textContent = 'De≈üifre durduruldu';
                }
            };

            try {
                speechRecognition.start();
                console.log('SpeechRecognition ba≈ülatƒ±ldƒ± (mikrofon)');
            } catch (e) {
                console.warn('SpeechRecognition ba≈ülatƒ±lamadƒ±:', e.message);
            }
        }

        function stopSpeechRecognition() {
            if (speechRecognition) {
                try {
                    speechRecognition.stop();
                } catch (e) {}
                speechRecognition = null;
            }
            document.getElementById('transcriptDot').classList.remove('listening');
            document.getElementById('transcriptStatus').textContent = 'De≈üifre tamamlandƒ±';
        }

        function addTranscriptLine(time, text, confidence, isFinal) {
            const body = document.getElementById('transcriptBody');
            // ƒ∞lk satƒ±rda placeholder varsa temizle
            if (body.children.length === 1 && body.children[0].style.fontStyle === 'italic') {
                body.innerHTML = '';
            }

            const line = document.createElement('div');
            line.className = 'transcript-line';
            const confPercent = Math.round(confidence * 100);
            const confColor = confPercent >= 80 ? '#2ecc71' : confPercent >= 50 ? '#f39c12' : '#e74c3c';
            line.innerHTML = `<span class="tl-time">${time}</span><span class="tl-text">${text}</span><span class="tl-confidence" style="color:${confColor};">${confPercent}%</span>`;
            body.appendChild(line);
            scrollTranscript();
        }

        function scrollTranscript() {
            const body = document.getElementById('transcriptBody');
            body.scrollTop = body.scrollHeight;
        }

        function toggleTranscriptPanel() {
            const panel = document.getElementById('transcriptPanel');
            const body = document.getElementById('transcriptBody');
            transcriptPanelMinimized = !transcriptPanelMinimized;
            body.style.display = transcriptPanelMinimized ? 'none' : 'block';
        }

        // Aktif soruyu takip et (marker eklenince g√ºncellenir)
        function updateActiveQuestion(questionNum) {
            currentActiveQuestion = questionNum;
        }

        function downloadTranscriptJSON() {
            if (transcriptData.transkript.length === 0) return;

            const m = transcriptData.meta;
            const jsonStr = JSON.stringify(transcriptData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const katilimci = m.katilimci || 'katilimci';
            const tarih = m.tarih || new Date().toISOString().slice(0, 10);
            a.download = `Desifre_${katilimci.replace(/\s+/g, '_')}_${tarih}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            console.log('De≈üifre JSON indirildi');
        }

        // Okunabilir TXT de≈üifre dosyasƒ± indir
        function downloadTranscriptTXT() {
            if (transcriptData.transkript.length === 0) return;

            const txt = generateTXTContent();
            const m = transcriptData.meta;

            const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const katilimci = m.katilimci || 'katilimci';
            const tarih = m.tarih || new Date().toISOString().slice(0, 10);
            a.download = `Desifre_${katilimci.replace(/\s+/g, '_')}_${tarih}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            console.log('De≈üifre TXT indirildi');
        }

        function formatDuration(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            if (h > 0) return h + ' saat ' + m + ' dk ' + s + ' sn';
            if (m > 0) return m + ' dk ' + s + ' sn';
            return s + ' sn';
        }

        // =============================================

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - recordingStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                // Her iki timer'ƒ± da g√ºncelle
                document.getElementById('recordingTimer').textContent = timeStr;
                document.getElementById('floatingTimer').textContent = timeStr;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateRecordingsList() {
            const container = document.getElementById('recordingsContainer');
            const list = document.getElementById('recordingsList');

            // √ñnce container'ƒ± temizle
            container.innerHTML = '';

            if (recordings.length > 0) {
                list.style.display = 'block';

                recordings.forEach((rec, index) => {
                    // Her kayƒ±t i√ßin div olu≈ütur
                    const recordingDiv = document.createElement('div');
                    recordingDiv.className = 'recording-item';

                    // Header
                    const header = document.createElement('div');
                    header.className = 'recording-item-header';
                    header.innerHTML = `
                        <span class="recording-item-name">${rec.name}</span>
                        <div>
                            <span style="opacity: 0.7; font-size: 11px;">${rec.duration} | ${rec.size}</span>
                        </div>
                    `;
                    recordingDiv.appendChild(header);

                    // Butonlar satƒ±rƒ±
                    const buttonsRow = document.createElement('div');
                    buttonsRow.style.cssText = 'display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;';
                    buttonsRow.innerHTML = `
                        <button onclick="downloadRecording(${index})" style="flex: 1; background: #3498db; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">üì• WAV ƒ∞ndir</button>
                        <button onclick="deleteRecording(${index})" style="background: #ffcccc; color: #c0392b; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">üóëÔ∏è</button>
                    `;
                    recordingDiv.appendChild(buttonsRow);

                    // Kayƒ±t bilgisi
                    const infoDiv = document.createElement('div');
                    infoDiv.style.cssText = 'font-size: 11px; color: #666; margin-top: 5px;';
                    infoDiv.textContent = 'Boyut: ' + rec.size + ' | Format: ' + (rec.mimeType || 'audio/webm');
                    recordingDiv.appendChild(infoDiv);

                    // Audio elementi ayrƒ± olu≈ütur (blob URL i√ßin daha g√ºvenilir)
                    const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.preload = 'auto';
                    audio.style.width = '100%';
                    audio.style.marginTop = '8px';

                    // Blob'dan yeni URL olu≈ütur
                    const audioUrl = URL.createObjectURL(rec.blob);
                    audio.src = audioUrl;

                    // Hata durumunda bildir
                    audio.onerror = function() {
                        console.error('Audio y√ºkleme hatasƒ±:', audio.error);
                        alert('Ses dosyasƒ± y√ºklenemedi. L√ºtfen indirip dinleyin.');
                    };

                    // Y√ºklendiƒüinde log
                    audio.onloadeddata = function() {
                        console.log('Audio y√ºklendi:', rec.name);
                    };

                    recordingDiv.appendChild(audio);
                    container.appendChild(recordingDiv);
                });
            } else {
                list.style.display = 'none';
            }
        }

        function deleteRecording(index) {
            if (confirm('Bu kaydƒ± silmek istediƒüinize emin misiniz?')) {
                recordings.splice(index, 1);
                updateRecordingsList();
            }
        }

        // WAV dosyasƒ±na marker g√∂merek indir (k√ºt√ºphanesiz, manuel)
        async function downloadWithEmbeddedMarkers(index) {
            const rec = recordings[index];

            if (!hasAnyTimestamps()) {
                alert('Hen√ºz zaman damgasƒ± eklenmemi≈ü. √ñnce "+ Zaman" butonlarƒ±nƒ± kullanƒ±n.');
                return;
            }

            const statusBtn = event.target;
            const originalText = statusBtn.textContent;
            statusBtn.textContent = 'ƒ∞≈üleniyor...';
            statusBtn.disabled = true;

            try {
                // 1. Audio blob'u AudioBuffer'a √ßevir
                const arrayBuffer = await rec.blob.arrayBuffer();
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

                // 2. Cue point listesi olu≈ütur
                const cuePoints = [];
                const questionLabels = [
                    'Soru01_Tanisma', 'Soru02_Tanim', 'Soru03_Tercih', 'Soru04_Kesif',
                    'Soru05_Mekan', 'Soru06_Sosyal', 'Soru07_Altyazi', 'Soru08_Sinif',
                    'Soru09_Maddi', 'Soru10_TurkSinema', 'Soru11_Senaryo', 'Soru12_Oneri',
                    'Soru13_Pandemi', 'Soru14_Gelecek', 'Soru15_Ek', 'Soru16_Favori'
                ];

                for (let i = 1; i <= 38; i++) {
                    const key = 'q' + i;
                    if (timestamps[key] && timestamps[key].length > 0) {
                        timestamps[key].forEach((time, idx) => {
                            const samplePos = Math.floor(timeToSeconds(time) * audioBuffer.sampleRate);
                            const label = questionLabels[i-1] + (timestamps[key].length > 1 ? '_' + (idx+1) : '');
                            cuePoints.push({ position: samplePos, label: label });
                        });
                    }
                }

                if (timestamps['general'] && timestamps['general'].length > 0) {
                    timestamps['general'].forEach((ts, idx) => {
                        const samplePos = Math.floor(timeToSeconds(ts.time) * audioBuffer.sampleRate);
                        cuePoints.push({ position: samplePos, label: ts.note || 'Marker_' + (idx+1) });
                    });
                }

                // Pozisyona g√∂re sƒ±rala
                cuePoints.sort((a, b) => a.position - b.position);

                // 3. WAV dosyasƒ± olu≈ütur (cue chunk ile)
                const wavData = audioBufferToWavWithCues(audioBuffer, cuePoints);

                // 4. ƒ∞ndir
                const wavBlob = new Blob([wavData], { type: 'audio/wav' });
                const url = URL.createObjectURL(wavBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = rec.name.replace(/\.(webm|ogg)$/, '_MARKERS.wav');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('WAV dosyasƒ± ' + cuePoints.length + ' marker ile indirildi.');

            } catch (error) {
                console.error('Marker g√∂mme hatasƒ±:', error);
                console.error('Marker g√∂mme hatasƒ±:', error.message);
            } finally {
                statusBtn.textContent = originalText;
                statusBtn.disabled = false;
            }
        }

        // Zaman string'ini milisaniyeye √ßevir (00:05:23 -> 323000)
        function timeToMilliseconds(timeStr) {
            const parts = timeStr.split(':');
            if (parts.length === 3) {
                return (parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2])) * 1000;
            } else if (parts.length === 2) {
                return (parseInt(parts[0]) * 60 + parseInt(parts[1])) * 1000;
            }
            return 0;
        }

        // AudioBuffer'ƒ± WAV formatƒ±na √ßevir (cue point'lerle birlikte)
        function audioBufferToWavWithCues(buffer, cuePoints) {
            const numChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const bitDepth = 16;
            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;
            const dataSize = buffer.length * blockAlign;

            // Cue chunk boyutunu hesapla
            const numCues = cuePoints.length;
            const cueChunkSize = 4 + (numCues * 24); // 4 byte cue count + 24 bytes per cue point

            // LIST/adtl chunk boyutunu hesapla (label'lar i√ßin)
            let listChunkSize = 4; // 'adtl'
            cuePoints.forEach((cue, idx) => {
                const labelBytes = new TextEncoder().encode(cue.label);
                // labl sub-chunk: 4 (labl) + 4 (size) + 4 (cue ID) + label + padding
                const labelChunkSize = 4 + labelBytes.length + (labelBytes.length % 2); // pad to even
                listChunkSize += 8 + labelChunkSize;
            });

            // Toplam dosya boyutu
            const headerSize = 44;
            const cueChunkTotalSize = 8 + cueChunkSize; // 'cue ' + size + data
            const listChunkTotalSize = 8 + listChunkSize; // 'LIST' + size + data
            const totalSize = headerSize + dataSize + cueChunkTotalSize + listChunkTotalSize;

            const arrayBuffer = new ArrayBuffer(totalSize);
            const view = new DataView(arrayBuffer);
            let offset = 0;

            // Helper fonksiyonlar
            const writeString = (str) => {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset++, str.charCodeAt(i));
                }
            };
            const writeUint32 = (val) => { view.setUint32(offset, val, true); offset += 4; };
            const writeUint16 = (val) => { view.setUint16(offset, val, true); offset += 2; };
            const writeInt16 = (val) => { view.setInt16(offset, val, true); offset += 2; };

            // RIFF header
            writeString('RIFF');
            writeUint32(totalSize - 8);
            writeString('WAVE');

            // fmt chunk
            writeString('fmt ');
            writeUint32(16);
            writeUint16(1); // PCM
            writeUint16(numChannels);
            writeUint32(sampleRate);
            writeUint32(sampleRate * blockAlign);
            writeUint16(blockAlign);
            writeUint16(bitDepth);

            // data chunk
            writeString('data');
            writeUint32(dataSize);

            // Audio verisi
            const channels = [];
            for (let i = 0; i < numChannels; i++) {
                channels.push(buffer.getChannelData(i));
            }
            for (let i = 0; i < buffer.length; i++) {
                for (let ch = 0; ch < numChannels; ch++) {
                    let sample = Math.max(-1, Math.min(1, channels[ch][i]));
                    sample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
                    writeInt16(sample);
                }
            }

            // cue chunk
            writeString('cue ');
            writeUint32(cueChunkSize);
            writeUint32(numCues);

            cuePoints.forEach((cue, idx) => {
                writeUint32(idx + 1);      // cue point ID
                writeUint32(cue.position); // play order position
                writeString('data');       // data chunk ID
                writeUint32(0);            // chunk start
                writeUint32(0);            // block start
                writeUint32(cue.position); // sample offset
            });

            // LIST chunk (labels i√ßin)
            writeString('LIST');
            writeUint32(listChunkSize);
            writeString('adtl');

            cuePoints.forEach((cue, idx) => {
                const labelBytes = new TextEncoder().encode(cue.label);
                const paddedLength = labelBytes.length + (labelBytes.length % 2);

                writeString('labl');
                writeUint32(4 + paddedLength); // size: cue ID + label + padding
                writeUint32(idx + 1);          // cue point ID

                for (let i = 0; i < labelBytes.length; i++) {
                    view.setUint8(offset++, labelBytes[i]);
                }
                // Padding (null terminator + even alignment)
                if (labelBytes.length % 2 === 0) {
                    view.setUint8(offset++, 0);
                    view.setUint8(offset++, 0);
                } else {
                    view.setUint8(offset++, 0);
                }
            });

            return arrayBuffer;
        }

        // Float32 PCM verisinden doƒürudan WAV olu≈ütur (cue point'lerle birlikte)
        // WebM decode'a ihtiya√ß duymaz - en g√ºvenilir y√∂ntem
        function pcmToWavWithCues(pcmData, sampleRate, cuePoints) {
            const numChannels = 1;
            const bitDepth = 16;
            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;
            const numSamples = pcmData.length;
            const dataSize = numSamples * blockAlign;

            // Cue chunk boyutu hesapla
            let cueChunkTotalSize = 0;
            let listChunkTotalSize = 0;

            if (cuePoints && cuePoints.length > 0) {
                const numCues = cuePoints.length;
                const cueChunkSize = 4 + (numCues * 24);
                cueChunkTotalSize = 8 + cueChunkSize;

                let listChunkSize = 4; // 'adtl'
                cuePoints.forEach(cue => {
                    const labelBytes = new TextEncoder().encode(cue.label || '');
                    const paddedLength = labelBytes.length + (labelBytes.length % 2 === 0 ? 2 : 1);
                    listChunkSize += 8 + 4 + paddedLength;
                });
                listChunkTotalSize = 8 + listChunkSize;
            }

            const headerSize = 44;
            const totalSize = headerSize + dataSize + cueChunkTotalSize + listChunkTotalSize;

            console.log('WAV olu≈üturuluyor (doƒürudan PCM):', {
                sampleRate: sampleRate,
                numSamples: numSamples,
                duration: (numSamples / sampleRate).toFixed(1) + 's',
                cuePoints: cuePoints ? cuePoints.length : 0,
                fileSize: (totalSize / 1024 / 1024).toFixed(1) + ' MB'
            });

            const arrayBuffer = new ArrayBuffer(totalSize);
            const view = new DataView(arrayBuffer);
            let offset = 0;

            const writeString = (str) => {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset++, str.charCodeAt(i));
                }
            };
            const writeUint32 = (val) => { view.setUint32(offset, val, true); offset += 4; };
            const writeUint16 = (val) => { view.setUint16(offset, val, true); offset += 2; };

            // RIFF header
            writeString('RIFF');
            writeUint32(totalSize - 8);
            writeString('WAVE');

            // fmt chunk
            writeString('fmt ');
            writeUint32(16);
            writeUint16(1); // PCM
            writeUint16(numChannels);
            writeUint32(sampleRate);
            writeUint32(sampleRate * blockAlign);
            writeUint16(blockAlign);
            writeUint16(bitDepth);

            // data chunk
            writeString('data');
            writeUint32(dataSize);

            // Audio verisi yaz
            for (let i = 0; i < numSamples; i++) {
                let sample = Math.max(-1, Math.min(1, pcmData[i]));
                sample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
                view.setInt16(offset, sample, true);
                offset += 2;
            }

            // Cue chunk (marker'lar)
            if (cuePoints && cuePoints.length > 0) {
                const numCues = cuePoints.length;
                const cueChunkSize = 4 + (numCues * 24);

                writeString('cue ');
                writeUint32(cueChunkSize);
                writeUint32(numCues);

                cuePoints.forEach((cue, idx) => {
                    writeUint32(idx + 1);      // cue point ID
                    writeUint32(cue.position); // play order position
                    writeString('data');       // data chunk ID
                    writeUint32(0);            // chunk start
                    writeUint32(0);            // block start
                    writeUint32(cue.position); // sample offset
                });

                // LIST chunk (label'lar - Audacity bu b√∂l√ºm√º okur)
                let listChunkSize = 4;
                cuePoints.forEach(cue => {
                    const labelBytes = new TextEncoder().encode(cue.label || '');
                    const paddedLength = labelBytes.length + (labelBytes.length % 2 === 0 ? 2 : 1);
                    listChunkSize += 8 + 4 + paddedLength;
                });

                writeString('LIST');
                writeUint32(listChunkSize);
                writeString('adtl');

                cuePoints.forEach((cue, idx) => {
                    const labelBytes = new TextEncoder().encode(cue.label || '');
                    const paddedLength = labelBytes.length + (labelBytes.length % 2 === 0 ? 2 : 1);

                    writeString('labl');
                    writeUint32(4 + paddedLength);
                    writeUint32(idx + 1);

                    for (let i = 0; i < labelBytes.length; i++) {
                        view.setUint8(offset++, labelBytes[i]);
                    }
                    // Padding (null terminator + even alignment)
                    if (labelBytes.length % 2 === 0) {
                        view.setUint8(offset++, 0);
                        view.setUint8(offset++, 0);
                    } else {
                        view.setUint8(offset++, 0);
                    }
                });
            }

            return new Uint8Array(arrayBuffer);
        }

        // AudioBuffer'ƒ± MONO WAV formatƒ±na √ßevir (konu≈üma i√ßin stereo gereksiz, boyut yarƒ±ya iner)
        function audioBufferToWav(buffer) {
            const sampleRate = buffer.sampleRate;
            const numChannels = 1; // Her zaman mono √ßƒ±kƒ±≈ü
            const format = 1; // PCM
            const bitDepth = 16;

            const bytesPerSample = bitDepth / 8;
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = buffer.length * blockAlign;
            const headerSize = 44;
            const totalSize = headerSize + dataSize;

            console.log('WAV olu≈üturuluyor:', {
                sampleRate: sampleRate,
                duration: buffer.duration + 's',
                inputChannels: buffer.numberOfChannels,
                outputChannels: numChannels,
                estimatedSize: (totalSize / 1024 / 1024).toFixed(1) + ' MB'
            });

            const arrayBuffer = new ArrayBuffer(totalSize);
            const view = new DataView(arrayBuffer);

            // WAV header yazma
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };

            writeString(0, 'RIFF');
            view.setUint32(4, totalSize - 8, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, format, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);
            writeString(36, 'data');
            view.setUint32(40, dataSize, true);

            // Stereo ‚Üí Mono mix-down (veya mono ‚Üí mono)
            const inputChannels = buffer.numberOfChannels;
            const ch0 = buffer.getChannelData(0);
            const ch1 = inputChannels > 1 ? buffer.getChannelData(1) : null;

            let offset = 44;
            for (let i = 0; i < buffer.length; i++) {
                let sample;
                if (ch1) {
                    // Stereo ‚Üí Mono: her iki kanalƒ±n ortalamasƒ±
                    sample = (ch0[i] + ch1[i]) / 2;
                } else {
                    sample = ch0[i];
                }
                sample = Math.max(-1, Math.min(1, sample));
                sample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
                view.setInt16(offset, sample, true);
                offset += 2;
            }

            return arrayBuffer;
        }

        // T√ºm marker'larƒ± topla ve milisaniyeye √ßevir
        function collectAllMarkers() {
            const markers = [];

            // Genel marker'lar
            if (timestamps['general'] && timestamps['general'].length > 0) {
                timestamps['general'].forEach((ts, idx) => {
                    markers.push({
                        position: timeToSeconds(ts.time) * 1000, // milisaniye
                        label: ts.note || ('Marker_' + (idx + 1))
                    });
                });
            }

            // Soru bazlƒ± marker'lar (string veya obje olabilir)
            for (let i = 1; i <= 38; i++) {
                const key = 'q' + i;
                if (timestamps[key] && timestamps[key].length > 0) {
                    timestamps[key].forEach((ts, idx) => {
                        const timeStr = typeof ts === 'string' ? ts : ts.time;
                        const noteStr = typeof ts === 'string' ? '' : (ts.note || '');
                        markers.push({
                            position: timeToSeconds(timeStr) * 1000,
                            label: 'S' + i + '_' + (noteStr || ('Marker_' + (idx + 1)))
                        });
                    });
                }
            }

            // Zamana g√∂re sƒ±rala
            markers.sort((a, b) => a.position - b.position);
            return markers;
        }

        // WAV olarak indir (PCM verisinden doƒürudan + Marker'larƒ± g√∂mer)
        async function downloadRecording(index) {
            const rec = recordings[index];
            if (!rec || !rec.blob) {
                alert('Kayƒ±t bulunamadƒ±. L√ºtfen √∂nce bir ses kaydƒ± yapƒ±n.');
                return;
            }

            try {
                const markers = collectAllMarkers();
                let finalWavData;
                let usedMethod = '';

                if (pcmChunks.length > 0 && pcmSampleRate > 0) {
                    // Y√ñNTEM 1: Doƒürudan PCM verisinden WAV olu≈ütur (en g√ºvenilir)
                    usedMethod = 'PCM doƒürudan';
                    console.log('=== Y√ñNTEM 1: PCM verisinden doƒürudan WAV ===');
                    console.log('PCM chunk sayƒ±sƒ±:', pcmChunks.length);

                    // T√ºm chunk'larƒ± birle≈ütir
                    const totalLength = pcmChunks.reduce((sum, chunk) => sum + chunk.length, 0);
                    const fullPCM = new Float32Array(totalLength);
                    let pcmOffset = 0;
                    for (const chunk of pcmChunks) {
                        fullPCM.set(chunk, pcmOffset);
                        pcmOffset += chunk.length;
                    }

                    console.log('PCM birle≈ütirildi:', {
                        totalSamples: totalLength,
                        duration: (totalLength / pcmSampleRate).toFixed(1) + 's',
                        sampleRate: pcmSampleRate,
                        estimatedWavSize: ((totalLength * 2 / 1024 / 1024) + 0.1).toFixed(1) + ' MB'
                    });

                    // Marker'larƒ± sample pozisyonuna √ßevir
                    const cuePoints = markers.map(m => ({
                        position: Math.round((m.position / 1000) * pcmSampleRate),
                        label: m.label
                    }));

                    finalWavData = pcmToWavWithCues(fullPCM, pcmSampleRate, cuePoints);

                } else {
                    // Y√ñNTEM 2: WebM ‚Üí decode ‚Üí WAV (fallback - PCM yoksa)
                    usedMethod = 'WebM decode';
                    console.log('=== Y√ñNTEM 2: WebM decode (PCM verisi yok) ===');

                    const arrayBuffer = await rec.blob.arrayBuffer();
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

                    console.log('Audio decode edildi:', {
                        duration: audioBuffer.duration,
                        sampleRate: audioBuffer.sampleRate,
                        channels: audioBuffer.numberOfChannels
                    });

                    // Mono mix-down
                    const ch0 = audioBuffer.getChannelData(0);
                    const ch1 = audioBuffer.numberOfChannels > 1 ? audioBuffer.getChannelData(1) : null;
                    const monoData = new Float32Array(audioBuffer.length);
                    for (let i = 0; i < audioBuffer.length; i++) {
                        monoData[i] = ch1 ? (ch0[i] + ch1[i]) / 2 : ch0[i];
                    }

                    // Marker'larƒ± sample pozisyonuna √ßevir
                    const cuePoints = markers.map(m => ({
                        position: Math.round((m.position / 1000) * audioBuffer.sampleRate),
                        label: m.label
                    }));

                    finalWavData = pcmToWavWithCues(monoData, audioBuffer.sampleRate, cuePoints);
                    audioContext.close();
                }

                // WAV indir
                const wavBlob = new Blob([finalWavData], { type: 'audio/wav' });
                const url = URL.createObjectURL(wavBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = rec.name.replace(/\.(webm|ogg)$/, '.wav');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                setTimeout(() => URL.revokeObjectURL(url), 100);

                const markerInfo = markers.length > 0 ? ` (${markers.length} marker g√∂m√ºld√º)` : '';
                console.log('WAV indirildi [' + usedMethod + ']:', rec.name.replace(/\.(webm|ogg)$/, '.wav') + markerInfo);

                if (markers.length > 0) {
                    console.log(`WAV dosyasƒ± indirildi! ${markers.length} marker g√∂m√ºld√º. Y√∂ntem: ${usedMethod}`);
                } else {
                    console.log('WAV dosyasƒ± indirildi! Y√∂ntem: ' + usedMethod);
                }

            } catch (err) {
                console.error('WAV d√∂n√º≈ü√ºm hatasƒ±:', err);
                const pcmInfo = pcmChunks.length > 0 ? 'PCM: ' + pcmChunks.length + ' chunk' : 'PCM: YOK';
                const srInfo = pcmSampleRate > 0 ? pcmSampleRate + 'Hz' : 'bilinmiyor';
                console.error('WAV d√∂n√º≈ü√ºm√º ba≈üarƒ±sƒ±z, orijinal WebM indiriliyor:', err.message);

                // Fallback: Orijinal WebM dosyasƒ±nƒ± indir
                const url = URL.createObjectURL(rec.blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = rec.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                setTimeout(() => URL.revokeObjectURL(url), 100);
            }
        }

        function hasAnyTimestamps() {
            for (let i = 1; i <= 38; i++) {
                if (timestamps['q' + i] && timestamps['q' + i].length > 0) return true;
            }
            if (timestamps['general'] && timestamps['general'].length > 0) return true;
            return false;
        }

        // Zaman damgasƒ±nƒ± saniyeye √ßevir (00:05:23 -> 323)
        function timeToSeconds(timeStr) {
            const parts = timeStr.split(':');
            if (parts.length === 3) {
                return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);
            } else if (parts.length === 2) {
                return parseInt(parts[0]) * 60 + parseInt(parts[1]);
            }
            return 0;
        }

        // Basit marker indirme (WAV d√∂n√º≈ü√ºm√º olmadan)
        function downloadMarkersOnly() {
            if (!hasAnyTimestamps()) {
                alert('Hen√ºz zaman damgasƒ± eklenmemi≈ü.\n\nKayƒ±t sƒ±rasƒ±nda M tu≈üuna basarak veya soru altƒ±ndaki "+ Zaman" butonlarƒ±yla ekleyebilirsiniz.');
                return;
            }

            const participantName = document.getElementById('participant-name').value || 'katilimci';
            const date = document.getElementById('interview-date').value || new Date().toISOString().slice(0, 10);

            let content = '';

            // Genel marker'lar (M tu≈üu ile eklenenler)
            if (timestamps['general'] && timestamps['general'].length > 0) {
                timestamps['general'].forEach((ts, idx) => {
                    const seconds = timeToSeconds(ts.time);
                    const label = ts.note || ('Marker_' + (idx + 1));
                    content += seconds + '\t' + seconds + '\t' + label + '\n';
                });
            }

            // Soru bazlƒ± marker'lar
            for (let i = 1; i <= 38; i++) {
                const key = 'q' + i;
                if (timestamps[key] && timestamps[key].length > 0) {
                    timestamps[key].forEach((time, idx) => {
                        const seconds = timeToSeconds(time);
                        const label = 'Soru_' + i + (timestamps[key].length > 1 ? '_' + (idx + 1) : '');
                        content += seconds + '\t' + seconds + '\t' + label + '\n';
                    });
                }
            }

            // Dosya olarak indir
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DerinlemesineGorusme_${participantName}_${date}_markers.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('Marker dosyasƒ± indirildi.');
        }

        // Audacity Label Track formatƒ±nda export
        function downloadMarkersForAudacity(audioFileName) {
            // Etiketler dizisi - fonksiyon i√ßinde tanƒ±mlanmalƒ±
            const labelNames = [
                'Soru01_Tanisma', 'Soru02_Tanim', 'Soru03_Tercih', 'Soru04_Kesif',
                'Soru05_Mekan', 'Soru06_Sosyal', 'Soru07_Altyazi', 'Soru08_Sinif',
                'Soru09_Maddi', 'Soru10_TurkSinema', 'Soru11_Senaryo', 'Soru12_Oneri',
                'Soru13_Pandemi', 'Soru14_Gelecek', 'Soru15_Ek', 'Soru16_Favori'
            ];

            let lines = [];

            // Soru zaman damgalarƒ±
            for (let i = 1; i <= 38; i++) {
                const key = 'q' + i;
                if (timestamps[key] && timestamps[key].length > 0) {
                    timestamps[key].forEach((time, idx) => {
                        const seconds = timeToSeconds(time);
                        // Etiket olu≈ütur
                        let markerLabel = labelNames[i - 1];
                        if (timestamps[key].length > 1) {
                            markerLabel = markerLabel + '_' + (idx + 1);
                        }
                        // Audacity format: start_time [TAB] end_time [TAB] label
                        lines.push(seconds + '\t' + seconds + '\t' + markerLabel);
                    });
                }
            }

            // Genel zaman damgalarƒ±
            if (timestamps['general'] && timestamps['general'].length > 0) {
                timestamps['general'].forEach((ts, idx) => {
                    const seconds = timeToSeconds(ts.time);
                    const markerLabel = ts.note ? ts.note.replace(/\s+/g, '_') : ('Genel_' + (idx + 1));
                    lines.push(seconds + '\t' + seconds + '\t' + markerLabel);
                });
            }

            if (lines.length > 0) {
                // Zamana g√∂re sƒ±rala
                lines.sort((a, b) => {
                    const timeA = parseFloat(a.split('\t')[0]);
                    const timeB = parseFloat(b.split('\t')[0]);
                    return timeA - timeB;
                });

                const content = lines.join('\n');
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = audioFileName.replace(/\.(webm|ogg)$/, '_labels.txt');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('Audacity labels exported:', lines);
            } else {
                alert('Hi√ß zaman damgasƒ± bulunamadƒ±.');
            }
        }

        // T√ºm marker'larƒ± dƒ±≈üa aktar
        function exportAllMarkers(format) {
            if (!hasAnyTimestamps()) {
                alert('Hen√ºz zaman damgasƒ± eklenmemi≈ü. Sorulardaki "+ Zaman" butonlarƒ±nƒ± kullanarak ekleyebilirsiniz.');
                return;
            }

            const participantName = document.getElementById('participant-name').value || 'katilimci';
            const date = document.getElementById('interview-date').value || new Date().toISOString().slice(0, 10);
            const baseName = `DerinlemesineGorusme_${participantName}_${date}`;

            if (format === 'audacity') {
                downloadMarkersForAudacity(baseName + '.webm');
            } else if (format === 'audition') {
                downloadMarkersForAudition(baseName + '.webm');
            } else {
                downloadMarkersGeneric(baseName);
            }
        }

        // Genel okunabilir format
        function downloadMarkersGeneric(baseName) {
            const questionLabels = [
                'Soru 1: Tanƒ±≈üma ve ilk sinema', 'Soru 2: Baƒüƒ±msƒ±z film tanƒ±mƒ±', 'Soru 3: Tercih nedenleri',
                'Soru 4: Ke≈üif ve eri≈üim', 'Soru 5: Mekan tercihleri', 'Soru 6: Sosyal boyut',
                'Soru 7: Altyazƒ±/dublaj', 'Soru 8: Sƒ±nƒ±f algƒ±sƒ±', 'Soru 9: Maddi boyut',
                'Soru 10: T√ºrk baƒüƒ±msƒ±z sinemasƒ±', 'Soru 11: Senaryo', 'Soru 12: √ñneriler',
                'Soru 13: Pandemi etkisi', 'Soru 14: Sinemanƒ±n geleceƒüi', 'Soru 15: Ek konular', 'Soru 16: Favori film'
            ];

            let content = `ZAMAN DAMGALARI - ${baseName}\n`;
            content += `${'='.repeat(50)}\n\n`;

            for (let i = 1; i <= 38; i++) {
                const key = 'q' + i;
                if (timestamps[key] && timestamps[key].length > 0) {
                    content += `${questionLabels[i-1]}\n`;
                    timestamps[key].forEach((time) => {
                        content += `  ‚Üí ${time}\n`;
                    });
                    content += '\n';
                }
            }

            if (timestamps['general'] && timestamps['general'].length > 0) {
                content += `Genel ƒ∞≈üaretler\n`;
                timestamps['general'].forEach((ts) => {
                    content += `  ‚Üí ${ts.time}${ts.note ? ' - ' + ts.note : ''}\n`;
                });
            }

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = baseName + '_zamanlar.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Adobe Audition CSV formatƒ±nda export
        function downloadMarkersForAudition(audioFileName) {
            let content = 'Name\tStart\tDuration\tTime Format\tType\tDescription\n';
            const questionLabels = [
                'Soru 1 - Tanisma', 'Soru 2 - Tanim', 'Soru 3 - Tercih', 'Soru 4 - Kesif',
                'Soru 5 - Mekan', 'Soru 6 - Sosyal', 'Soru 7 - Altyazi', 'Soru 8 - Sinif',
                'Soru 9 - Maddi', 'Soru 10 - Turk Sinemasi', 'Soru 11 - Senaryo', 'Soru 12 - Oneri',
                'Soru 13 - Pandemi', 'Soru 14 - Gelecek', 'Soru 15 - Ek', 'Soru 16 - Favori'
            ];

            for (let i = 1; i <= 38; i++) {
                const key = 'q' + i;
                if (timestamps[key] && timestamps[key].length > 0) {
                    timestamps[key].forEach((time) => {
                        content += `${questionLabels[i-1]}\t${time}\t0:00:00\tdecimal\tCue\t\n`;
                    });
                }
            }

            if (timestamps['general'] && timestamps['general'].length > 0) {
                timestamps['general'].forEach((ts) => {
                    content += `${ts.note || 'Marker'}\t${ts.time}\t0:00:00\tdecimal\tCue\t\n`;
                });
            }

            const blob = new Blob([content], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = audioFileName.replace(/\.(webm|ogg)$/, '_markers.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Aktif audio'yu takip et (aynƒ± anda sadece bir tane √ßalsƒ±n)
        document.addEventListener('play', function(e) {
            const audios = document.getElementsByTagName('audio');
            for (let i = 0; i < audios.length; i++) {
                if (audios[i] !== e.target) {
                    audios[i].pause();
                }
            }
        }, true);

        // ZAMAN DAMGASI FONKSƒ∞YONLARI
        function addTimestamp(questionNum) {
            const currentTime = document.getElementById('recordingTimer').textContent;
            const key = 'q' + questionNum;
            timestamps[key].push(currentTime);

            const container = document.getElementById('timestamps-' + key);
            container.innerHTML = timestamps[key].map(t => `<span>${t}</span>`).join('');

            // G√∂rsel geri bildirim - yeni eklenen span'ƒ± vurgula
            const newSpan = container.lastElementChild;
            if (newSpan) {
                newSpan.style.background = '#27ae60';
                newSpan.style.color = 'white';
                newSpan.style.borderColor = '#27ae60';
                setTimeout(() => {
                    newSpan.style.background = '#f5eef8';
                    newSpan.style.color = '#8e44ad';
                    newSpan.style.borderColor = '#d8bfe8';
                }, 1500);
            }

            console.log(`Soru ${questionNum} i√ßin zaman damgasƒ± eklendi: ${currentTime}`);

            // Aktif soruyu g√ºncelle (de≈üifre i√ßin)
            updateActiveQuestion(questionNum);
        }

        function addManualTimestamp() {
            const currentTime = document.getElementById('recordingTimer').textContent;
            timestamps['general'].push({
                time: currentTime,
                note: prompt('Bu zaman damgasƒ± i√ßin not (opsiyonel):') || ''
            });
            alert(`Zaman damgasƒ± eklendi: ${currentTime}`);
        }

        // JSON DI≈ûA AKTARMA
        function exportJSON() {
            const formData = collectFormData();
            formData.timestamps = timestamps;
            formData.zoomRecordingInfo = document.getElementById('zoom-recording-info').value;
            formData.exportDate = new Date().toISOString();

            const blob = new Blob([JSON.stringify(formData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const participantName = formData.participantName || 'katilimci';
            a.download = `DerinlemesineGorusme_${participantName.replace(/\s+/g, '_')}_${formData.interviewDate || 'tarihsiz'}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function collectFormData() {
            const formData = {
                grup: 'Derinlemesine G√∂r√º≈üme',
                interviewerName: document.getElementById('interviewer-name').value,
                participantName: document.getElementById('participant-name').value,
                focusGroup: document.getElementById('focus-group').value,
                interviewDate: document.getElementById('interview-date').value,
                interviewTime: document.getElementById('interview-time').value,
                interviewStatus: document.getElementById('interview-status').value,
                interviewType: document.getElementById('interview-type').value,
                generalNotes: document.getElementById('general-notes').value,
                notes: {},
                timestamps: {}
            };

            for (let i = 1; i <= 38; i++) {
                const noteEl = document.getElementById('note-q' + i);
                if (noteEl) {
                    formData.notes['q' + i] = noteEl.value;
                    formData.timestamps['q' + i] = timestamps['q' + i] || [];
                }
            }

            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            formData.checklistStates = [];
            checkboxes.forEach((cb, index) => {
                formData.checklistStates[index] = cb.checked;
            });

            return formData;
        }

        // Form verilerini localStorage'a kaydet
        function saveForm() {
            const formData = {
                interviewerName: document.getElementById('interviewer-name').value,
                participantName: document.getElementById('participant-name').value,
                focusGroup: document.getElementById('focus-group').value,
                interviewDate: document.getElementById('interview-date').value,
                interviewTime: document.getElementById('interview-time').value,
                interviewStatus: document.getElementById('interview-status').value,
                interviewType: document.getElementById('interview-type').value,
                generalNotes: document.getElementById('general-notes').value,
                zoomRecordingInfo: document.getElementById('zoom-recording-info').value,
                notes: {},
                timestamps: timestamps
            };

            // T√ºm soru notlarƒ±nƒ± kaydet
            for (let i = 1; i <= 38; i++) {
                const noteEl = document.getElementById('note-q' + i);
                if (noteEl) {
                    formData.notes['q' + i] = noteEl.value;
                }
            }

            // Kontrol listesi durumlarƒ±nƒ± kaydet
            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            formData.checklistStates = [];
            checkboxes.forEach((cb, index) => {
                formData.checklistStates[index] = cb.checked;
            });

            // Kaydet
            const storageKey = 'derinlemesineGorusme_' + (formData.participantName || 'default');
            localStorage.setItem(storageKey, JSON.stringify(formData));
            localStorage.setItem('odakDerinlemesineGorusme_lastSave', storageKey);

            // Durumu g√ºncelle
            updateSaveStatus(true);
            alert('Form kaydedildi! Katƒ±lƒ±mcƒ±: ' + (formData.participantName || 'Belirtilmedi'));
        }

        // Formu y√ºkle
        function loadForm() {
            const lastSaveKey = localStorage.getItem('odakDerinlemesineGorusme_lastSave');
            if (!lastSaveKey) return;

            const savedData = localStorage.getItem(lastSaveKey);
            if (!savedData) return;

            const formData = JSON.parse(savedData);

            document.getElementById('interviewer-name').value = formData.interviewerName || '';
            document.getElementById('participant-name').value = formData.participantName || '';
            document.getElementById('focus-group').value = formData.focusGroup || 'G1';
            document.getElementById('interview-date').value = formData.interviewDate || '';
            document.getElementById('interview-time').value = formData.interviewTime || '';
            document.getElementById('interview-status').value = formData.interviewStatus || 'basladi';
            document.getElementById('interview-type').value = formData.interviewType || 'online';
            document.getElementById('general-notes').value = formData.generalNotes || '';
            document.getElementById('zoom-recording-info').value = formData.zoomRecordingInfo || '';

            // Notlarƒ± y√ºkle
            if (formData.notes) {
                for (let i = 1; i <= 38; i++) {
                    const noteEl = document.getElementById('note-q' + i);
                    if (noteEl && formData.notes['q' + i]) {
                        noteEl.value = formData.notes['q' + i];
                    }
                }
            }

            // Zaman damgalarƒ±nƒ± y√ºkle
            if (formData.timestamps) {
                timestamps = formData.timestamps;
                // UI'ƒ± g√ºncelle
                for (let i = 1; i <= 38; i++) {
                    const container = document.getElementById('timestamps-q' + i);
                    if (container && timestamps['q' + i]) {
                        container.innerHTML = timestamps['q' + i].map(t => `<span>${t}</span>`).join('');
                    }
                }
            }

            // Kontrol listesini y√ºkle
            if (formData.checklistStates) {
                const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
                checkboxes.forEach((cb, index) => {
                    if (formData.checklistStates[index] !== undefined) {
                        cb.checked = formData.checklistStates[index];
                    }
                });
            }

            updateSaveStatus(true);
        }

        // Formu temizle
        function clearForm() {
            if (!confirm('T√ºm form verileri silinecek. Emin misiniz?')) return;

            document.getElementById('interviewer-name').value = '';
            document.getElementById('participant-name').value = '';
            document.getElementById('focus-group').value = 'G1';
            document.getElementById('interview-date').value = '';
            document.getElementById('interview-time').value = '';
            document.getElementById('interview-status').value = 'basladi';
            document.getElementById('interview-type').value = 'online';
            document.getElementById('general-notes').value = '';
            document.getElementById('zoom-recording-info').value = '';

            for (let i = 1; i <= 38; i++) {
                const noteEl = document.getElementById('note-q' + i);
                if (noteEl) noteEl.value = '';

                // Zaman damgalarƒ±nƒ± temizle
                const tsContainer = document.getElementById('timestamps-q' + i);
                if (tsContainer) tsContainer.innerHTML = '';
                timestamps['q' + i] = [];
            }
            timestamps['general'] = [];

            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);

            // Kayƒ±tlarƒ± temizle
            recordings = [];
            document.getElementById('recordingsContainer').innerHTML = '';
            document.getElementById('recordingsList').style.display = 'none';

            updateSaveStatus(false);
        }

        // TXT olarak dƒ±≈üa aktar (Geli≈ümi≈ü Rapor)
        function exportForm() {
            const interviewerName = document.getElementById('interviewer-name').value || 'Belirtilmedi';
            const participantName = document.getElementById('participant-name').value || 'Belirtilmedi';
            const interviewDate = document.getElementById('interview-date').value || 'Belirtilmedi';
            const interviewTime = document.getElementById('interview-time').value || 'Belirtilmedi';
            const interviewStatus = document.getElementById('interview-status').selectedOptions[0].text;
            const interviewType = document.getElementById('interview-type').selectedOptions[0].text;
            const generalNotes = document.getElementById('general-notes').value || '-';
            const zoomInfo = document.getElementById('zoom-recording-info').value || '-';

            let content = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    DERƒ∞NLEMESƒ∞NE G√ñR√ú≈ûME RAPORU                              ‚ïë
‚ïë                  Sinema Seyircisi Ara≈ütƒ±rmasƒ±                          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ G√ñR√ú≈ûME Bƒ∞LGƒ∞LERƒ∞                                                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ G√∂r√º≈ümeci    : ${interviewerName.padEnd(58)}‚îÇ
‚îÇ Katƒ±lƒ±mcƒ±    : ${participantName.padEnd(58)}‚îÇ
‚îÇ Tarih        : ${interviewDate.padEnd(58)}‚îÇ
‚îÇ Saat         : ${interviewTime.padEnd(58)}‚îÇ
‚îÇ Durum        : ${interviewStatus.padEnd(58)}‚îÇ
‚îÇ T√ºr          : ${interviewType.padEnd(58)}‚îÇ
‚îÇ Zoom Kaydƒ±   : ${zoomInfo.padEnd(58)}‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GENEL NOTLAR / ƒ∞ZLENƒ∞MLER                                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
${generalNotes}

`;

            const questionTitles = [
                'Tanƒ±≈üma ve ilk sinema deneyimi',
                'Baƒüƒ±msƒ±z film tanƒ±mƒ±',
                'Tercih nedenleri',
                'Ke≈üif ve eri≈üim',
                'Mekan tercihleri',
                'Sosyal boyut - kiminle izliyor',
                'Altyazƒ±/dublaj tercihi',
                'Sƒ±nƒ±fsal algƒ±',
                'Maddi boyut',
                'T√ºrk baƒüƒ±msƒ±z sinemasƒ±',
                'Senaryo sorusu',
                '√ñneriler',
                'Pandemi etkisi',
                'Sinemanƒ±n geleceƒüi',
                'Ek konular',
                'Favori film'
            ];

            const sections = [
                { name: 'B√ñL√úM 1: ISINMA', questions: [1] },
                { name: 'B√ñL√úM 2: ANA SORULAR', questions: [2, 3, 4, 5, 6, 7] },
                { name: 'B√ñL√úM 3: SOSYAL SINIF ALGISI', questions: [8, 9] },
                { name: 'B√ñL√úM 4: DERƒ∞NLE≈ûTƒ∞RME', questions: [10, 11, 12, 13, 14] },
                { name: 'B√ñL√úM 5: KAPANI≈û', questions: [15, 16] }
            ];

            sections.forEach(section => {
                content += `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë ${section.name.padEnd(76)}‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
`;
                section.questions.forEach(i => {
                    const noteEl = document.getElementById('note-q' + i);
                    const noteValue = noteEl ? (noteEl.value || '(Not eklenmedi)') : '(Not eklenmedi)';
                    const questionTimestamps = timestamps['q' + i] || [];
                    const timestampStr = questionTimestamps.length > 0 ? `[Zaman: ${questionTimestamps.join(', ')}]` : '';

                    content += `
‚îå‚îÄ SORU ${i}: ${questionTitles[i-1]} ${timestampStr}
‚îÇ
${noteValue.split('\n').map(line => '‚îÇ  ' + line).join('\n')}
‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

`;
                });
            });

            // Genel zaman damgalarƒ±
            if (timestamps['general'] && timestamps['general'].length > 0) {
                content += `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë ZAMAN DAMGALARI                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
`;
                timestamps['general'].forEach((ts, idx) => {
                    content += `${ts.time} - ${ts.note || '(not yok)'}\n`;
                });
            }

            content += `

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
T√úBƒ∞TAK 1001 - Cumhuriyetin 100. Yƒ±lƒ±nda Sinema Seyircisi Ara≈ütƒ±rmasƒ±
Rapor olu≈üturma tarihi: ${new Date().toLocaleString('tr-TR')}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;

            // Dosyayƒ± indir
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DerinlemesineGorusme_Rapor_${participantName.replace(/\s+/g, '_')}_${interviewDate || 'tarihsiz'}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Kayƒ±t durumunu g√ºncelle
        function updateSaveStatus(saved) {
            const dot = document.getElementById('save-status-dot');
            const text = document.getElementById('save-status-text');
            if (saved) {
                dot.classList.add('saved');
                text.textContent = 'Son kayƒ±t: ' + new Date().toLocaleTimeString('tr-TR');
            } else {
                dot.classList.remove('saved');
                text.textContent = 'Hen√ºz kaydedilmedi';
            }
        }

        // Otomatik kaydetme (her 60 saniyede)
        setInterval(() => {
            const participantName = document.getElementById('participant-name').value;
            if (participantName) {
                saveFormSilent();
            }
        }, 60000);

        function saveFormSilent() {
            const formData = {
                interviewerName: document.getElementById('interviewer-name').value,
                participantName: document.getElementById('participant-name').value,
                interviewDate: document.getElementById('interview-date').value,
                interviewTime: document.getElementById('interview-time').value,
                interviewStatus: document.getElementById('interview-status').value,
                interviewType: document.getElementById('interview-type').value,
                generalNotes: document.getElementById('general-notes').value,
                zoomRecordingInfo: document.getElementById('zoom-recording-info').value,
                notes: {},
                timestamps: timestamps
            };

            for (let i = 1; i <= 38; i++) {
                const noteEl = document.getElementById('note-q' + i);
                if (noteEl) formData.notes['q' + i] = noteEl.value;
            }

            const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
            formData.checklistStates = [];
            checkboxes.forEach((cb, index) => {
                formData.checklistStates[index] = cb.checked;
            });

            const storageKey = 'derinlemesineGorusme_' + (formData.participantName || 'default');
            localStorage.setItem(storageKey, JSON.stringify(formData));
            localStorage.setItem('odakDerinlemesineGorusme_lastSave', storageKey);
            updateSaveStatus(true);
        }

        // Sayfa y√ºklendiƒüinde √∂nceki verileri y√ºkle
        document.addEventListener('DOMContentLoaded', function() {
            loadForm();

            // Bug√ºn√ºn tarihini varsayƒ±lan olarak ayarla
            const today = new Date().toISOString().split('T')[0];
            if (!document.getElementById('interview-date').value) {
                document.getElementById('interview-date').value = today;
            }

            // D√ºzenleme modu i√ßin sorularƒ± hazƒ±rla
            initEditMode();

        });

        // ==================== D√úZENLEME MODU FONKSƒ∞YONLARI ====================

        let editModeActive = false;

        function toggleEditMode() {
            editModeActive = !editModeActive;
            document.body.classList.toggle('edit-mode', editModeActive);
            document.getElementById('editModeBtn').classList.toggle('active', editModeActive);

            // ƒ∞pucu kutusunu g√∂ster/gizle
            const tipsBox = document.getElementById('editModeTips');
            if (tipsBox) {
                tipsBox.style.display = editModeActive ? 'block' : 'none';
            }

            if (editModeActive) {
                enableEditing();
            } else {
                disableEditing();
            }
        }

        function initEditMode() {
            // Her soru i√ßin d√ºzenleme yapƒ±sƒ±nƒ± hazƒ±rla
            document.querySelectorAll('.question').forEach((question, index) => {
                // Soru silme butonu ekle
                if (!question.querySelector('.delete-question-btn')) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-question-btn';
                    deleteBtn.innerHTML = '‚úï';
                    deleteBtn.title = 'Soruyu Sil';
                    deleteBtn.onclick = function() { deleteQuestion(this); };
                    question.appendChild(deleteBtn);
                }

                // Probe listelerine ekle/sil butonlarƒ± ekle
                const probeUl = question.querySelector('.probe ul');
                if (probeUl) {
                    probeUl.querySelectorAll('li').forEach(li => {
                        if (!li.querySelector('.edit-controls')) {
                            const controls = document.createElement('span');
                            controls.className = 'edit-controls';
                            controls.innerHTML = `
                                <button class="edit-btn edit-btn-delete" onclick="deleteProbe(this)" title="Sil">‚úï</button>
                            `;
                            li.appendChild(controls);
                        }
                    });

                    // "Takip sorusu ekle" butonu
                    if (!probeUl.parentElement.querySelector('.add-probe-btn')) {
                        const addBtn = document.createElement('button');
                        addBtn.className = 'add-probe-btn';
                        addBtn.textContent = '+ Takip Sorusu Ekle';
                        addBtn.onclick = function() { addProbe(this); };
                        probeUl.parentElement.appendChild(addBtn);
                    }
                }
            });

            // Yeni soru ekleme butonlarƒ±nƒ± ekle (her section-content sonuna)
            document.querySelectorAll('.section-content').forEach(section => {
                if (!section.querySelector('.add-question-btn')) {
                    const addQBtn = document.createElement('button');
                    addQBtn.className = 'add-question-btn';
                    addQBtn.innerHTML = '‚ûï Yeni Soru Ekle';
                    addQBtn.onclick = function() { addNewQuestion(this); };
                    section.appendChild(addQBtn);
                }
            });

            // Connection-note'lara sil butonu ekle
            document.querySelectorAll('.connection-note').forEach(note => {
                if (!note.querySelector('.delete-note-btn')) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-note-btn';
                    deleteBtn.innerHTML = '‚úï';
                    deleteBtn.title = 'Notu Sil';
                    deleteBtn.onclick = function(e) {
                        e.stopPropagation();
                        deleteConnectionNote(this);
                    };
                    note.appendChild(deleteBtn);
                }
            });

            // Her soruya "Anket Baƒülantƒ±sƒ± Ekle" butonu ekle
            document.querySelectorAll('.question').forEach(question => {
                const noteArea = question.querySelector('.note-area');
                if (noteArea && !question.querySelector('.add-connection-btn')) {
                    const addConnBtn = document.createElement('button');
                    addConnBtn.className = 'add-connection-btn';
                    addConnBtn.innerHTML = '+ Anket Baƒülantƒ±sƒ± Ekle';
                    addConnBtn.onclick = function() { addConnectionNote(this); };
                    noteArea.parentNode.insertBefore(addConnBtn, noteArea);
                }
            });
        }

        function enableEditing() {
            // Ba≈ülƒ±klarƒ± d√ºzenlenebilir yap
            const headerH1 = document.querySelector('.header h1');
            const headerSubtitle = document.querySelector('.header .subtitle');
            if (headerH1) headerH1.contentEditable = true;
            if (headerSubtitle) headerSubtitle.contentEditable = true;

            // Ana soru metinlerini d√ºzenlenebilir yap
            document.querySelectorAll('.question-text .main').forEach(el => {
                el.contentEditable = true;
            });

            // Takip sorularƒ±nƒ± d√ºzenlenebilir yap
            document.querySelectorAll('.probe ul li').forEach(li => {
                li.contentEditable = true;
            });

            // Anket baƒülantƒ±larƒ±nƒ± d√ºzenlenebilir yap
            document.querySelectorAll('.connection-note').forEach(note => {
                note.contentEditable = true;
            });
        }

        function disableEditing() {
            // Ba≈ülƒ±k d√ºzenlemesini kapat
            const headerH1 = document.querySelector('.header h1');
            const headerSubtitle = document.querySelector('.header .subtitle');
            if (headerH1) headerH1.contentEditable = false;
            if (headerSubtitle) headerSubtitle.contentEditable = false;

            // D√ºzenlemeyi kapat
            document.querySelectorAll('.question-text .main').forEach(el => {
                el.contentEditable = false;
            });

            document.querySelectorAll('.probe ul li').forEach(li => {
                li.contentEditable = false;
            });

            // Anket baƒülantƒ±larƒ± d√ºzenlemesini kapat
            document.querySelectorAll('.connection-note').forEach(note => {
                note.contentEditable = false;
            });
        }

        function deleteProbe(btn) {
            if (confirm('Bu takip sorusunu silmek istediƒüinize emin misiniz?')) {
                const li = btn.closest('li');
                li.remove();
            }
        }

        function addProbe(btn) {
            const ul = btn.previousElementSibling;
            const newLi = document.createElement('li');
            newLi.contentEditable = true;
            newLi.innerHTML = `Yeni takip sorusu... <span class="edit-controls"><button class="edit-btn edit-btn-delete" onclick="deleteProbe(this)" title="Sil">‚úï</button></span>`;
            ul.appendChild(newLi);
            newLi.focus();

            // Metin se√ß
            const range = document.createRange();
            range.selectNodeContents(newLi.firstChild);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
        }

        function addNewQuestion(btn) {
            const sectionContent = btn.parentElement;
            const questions = document.querySelectorAll('.question');
            const newNum = questions.length + 1;

            const newQuestion = document.createElement('div');
            newQuestion.className = 'question';
            newQuestion.innerHTML = `
                <button class="delete-question-btn" onclick="deleteQuestion(this)" title="Soruyu Sil">‚úï</button>
                <div class="question-text">
                    <span class="question-number">${newNum}</span>
                    <span class="main" contenteditable="true">Yeni soru metni buraya yazƒ±lacak...</span>
                </div>
                <div class="probe">
                    <ul>
                        <li contenteditable="true">Takip sorusu 1... <span class="edit-controls"><button class="edit-btn edit-btn-delete" onclick="deleteProbe(this)" title="Sil">‚úï</button></span></li>
                    </ul>
                    <button class="add-probe-btn" onclick="addProbe(this)" style="display: inline-block;">+ Takip Sorusu Ekle</button>
                </div>
                <div class="note-area">
                    <div class="note-area-label">Notlar - Soru ${newNum} <button class="timestamp-btn" onclick="addTimestamp(${newNum})">+ Zaman</button></div>
                    <div class="timestamps-list" id="timestamps-q${newNum}"></div>
                    <textarea id="note-q${newNum}" placeholder="Notlarƒ±nƒ±z..."></textarea>
                </div>
            `;

            // Butonu √∂nce kaldƒ±r, soruyu ekle, butonu tekrar ekle
            sectionContent.removeChild(btn);
            sectionContent.appendChild(newQuestion);
            sectionContent.appendChild(btn);

            // Yeni soruya odaklan
            newQuestion.querySelector('.main').focus();

            // Soru numaralarƒ±nƒ± g√ºncelle
            updateQuestionNumbers();
        }

        function deleteQuestion(btn) {
            if (confirm('Bu soruyu silmek istediƒüinize emin misiniz?')) {
                const question = btn.closest('.question');
                question.remove();
                updateQuestionNumbers();
            }
        }

        function updateQuestionNumbers() {
            document.querySelectorAll('.question').forEach((question, index) => {
                const numSpan = question.querySelector('.question-number');
                if (numSpan) {
                    numSpan.textContent = index + 1;
                }
                const noteLabel = question.querySelector('.note-area-label');
                if (noteLabel) {
                    noteLabel.innerHTML = `Notlar - Soru ${index + 1} <button class="timestamp-btn" onclick="addTimestamp(${index + 1})">+ Zaman</button>`;
                }
            });
        }

        function deleteConnectionNote(btn) {
            if (confirm('Bu anket baƒülantƒ±sƒ±nƒ± silmek istediƒüinize emin misiniz?')) {
                const note = btn.closest('.connection-note');
                note.remove();
            }
        }

        function addConnectionNote(btn) {
            const question = btn.closest('.question');
            const newNote = document.createElement('div');
            newNote.className = 'connection-note';
            newNote.contentEditable = true;
            newNote.innerHTML = `<strong>Anket Baƒülantƒ±sƒ±:</strong> Buraya anket sorusu baƒülantƒ±sƒ± yazƒ±n... <button class="delete-note-btn" onclick="event.stopPropagation(); deleteConnectionNote(this)" title="Notu Sil" style="display: flex; align-items: center; justify-content: center;">‚úï</button>`;

            // Butonu √∂n√ºne ekle
            btn.parentNode.insertBefore(newNote, btn);

            // Odaklan
            newNote.focus();
        }

        function saveQuestionChanges() {
            // Deƒüi≈üiklikleri topla
            const changes = {
                timestamp: new Date().toISOString(),
                header: {
                    title: document.querySelector('.header h1')?.textContent.trim() || '',
                    subtitle: document.querySelector('.header .subtitle')?.textContent.trim() || ''
                },
                questions: []
            };

            document.querySelectorAll('.question').forEach((question, index) => {
                const mainText = question.querySelector('.question-text .main');
                const probes = question.querySelectorAll('.probe ul li');
                const connectionNotes = question.querySelectorAll('.connection-note');

                const questionData = {
                    number: index + 1,
                    mainQuestion: mainText ? mainText.textContent.trim() : '',
                    probes: [],
                    connectionNotes: []
                };

                probes.forEach(li => {
                    // Edit controls'√º hari√ß tut
                    const text = li.childNodes[0].textContent.trim();
                    if (text) {
                        questionData.probes.push(text);
                    }
                });

                connectionNotes.forEach(note => {
                    // Delete butonunu hari√ß tut
                    const text = note.textContent.replace('‚úï', '').trim();
                    if (text) {
                        questionData.connectionNotes.push(text);
                    }
                });

                changes.questions.push(questionData);
            });

            // LocalStorage'a kaydet
            localStorage.setItem('odakDerinlemesineGorusme_questionChanges', JSON.stringify(changes));

            // Bildirim g√∂ster
            alert('‚úÖ Soru deƒüi≈üiklikleri kaydedildi!\n\nDeƒüi≈üiklikler bu tarayƒ±cƒ±da saklanacaktƒ±r.');

            console.log('Kaydedilen deƒüi≈üiklikler:', changes);
        }

        function loadQuestionChanges() {
            const saved = localStorage.getItem('odakDerinlemesineGorusme_questionChanges');
            if (saved) {
                const changes = JSON.parse(saved);
                console.log('Y√ºklenen soru deƒüi≈üiklikleri:', changes);

                // Ba≈ülƒ±k deƒüi≈üikliklerini uygula
                if (changes.header) {
                    const headerH1 = document.querySelector('.header h1');
                    const headerSubtitle = document.querySelector('.header .subtitle');
                    if (headerH1 && changes.header.title) {
                        headerH1.textContent = changes.header.title;
                    }
                    if (headerSubtitle && changes.header.subtitle) {
                        headerSubtitle.textContent = changes.header.subtitle;
                    }
                }

                // Soru deƒüi≈üikliklerini uygula
                changes.questions.forEach((q, index) => {
                    const question = document.querySelectorAll('.question')[index];
                    if (question) {
                        const mainText = question.querySelector('.question-text .main');
                        if (mainText && q.mainQuestion) {
                            mainText.textContent = q.mainQuestion;
                        }

                        const probeUl = question.querySelector('.probe ul');
                        if (probeUl && q.probes && q.probes.length > 0) {
                            probeUl.innerHTML = '';
                            q.probes.forEach(probeText => {
                                const li = document.createElement('li');
                                li.innerHTML = `${probeText} <span class="edit-controls"><button class="edit-btn edit-btn-delete" onclick="deleteProbe(this)" title="Sil">‚úï</button></span>`;
                                probeUl.appendChild(li);
                            });
                        }
                    }
                });

                return true;
            }
            return false;
        }

        // Sayfa y√ºklendiƒüinde kaydedilmi≈ü deƒüi≈üiklikleri kontrol et
        if (loadQuestionChanges()) {
            console.log('√ñnceki soru deƒüi≈üiklikleri y√ºklendi.');
        }
    </script>
</body>
</html>
